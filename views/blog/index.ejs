<!-- Blog Hero -->
<div class="page__hero">
  <div class="container">
    <% if (typeof query !== 'undefined' && query) { %>
      <h1 class="page__hero__title">Keres√©s: "<%= query %>"</h1>
      <p class="page__hero__subtitle">
        <% if (totalPosts > 0) { %>
          <strong><%= totalPosts %></strong> tal√°lat a keres√©sre
        <% } else { %>
          Nincs tal√°lat erre a keres√©sre
        <% } %>
      </p>
    <% } else { %>
      <h1 class="page__hero__title">Blog</h1>
      <p class="page__hero__subtitle">
        Szakmai cikkek, tippek √©s h√≠rek a koncertszervez√©s vil√°g√°b√≥l
      </p>
    <% } %>
    
    <!-- Hero Search -->
    <div class="hero-search">
      <form action="<%= basePath %>blog/kereses" method="GET" class="hero-search__form" id="blog-search-form">
        <input 
          type="text" 
          name="q" 
          id="blog-search-input"
          class="hero-search__input" 
          placeholder="Keres√©s a cikkek k√∂z√∂tt..." 
          value="<%= typeof query !== 'undefined' ? query : '' %>"
          aria-label="Keres√©s a blog cikkek k√∂z√∂tt"
        >
        <button type="button" class="hero-search__clear <%= (typeof query !== 'undefined' && query) ? '' : 'hidden' %>" id="blog-search-clear" aria-label="Keres√©s t√∂rl√©se">
          <svg viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </button>
        <button type="submit" class="hero-search__button" aria-label="Keres√©s">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
          </svg>
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Breadcrumbs -->
<nav aria-label="Breadcrumb" class="container pt-4">
  <ol class="breadcrumb">
    <li class="breadcrumb__item">
      <a href="<%= basePath %>"><svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/></svg>F≈ëoldal</a>
    </li>
    <li class="breadcrumb__item" aria-current="page">Blog</li>
  </ol>
</nav>

<!-- Blog Content -->
<section class="section">
  <div class="container">
    
    <!-- Filter & Result Count -->
    <div class="flex items-center justify-between flex-wrap gap-4 mb-6">
      <div class="filter-tabs">
        <a href="<%= basePath %>blog" class="filter-tab <%= !filter ? 'filter-tab--active' : '' %>">
          √ñsszes
        </a>
        <a href="<%= basePath %>blog?filter=popular" class="filter-tab <%= filter === 'popular' ? 'filter-tab--active' : '' %>">
          N√©pszer≈±
        </a>
        <a href="<%= basePath %>blog?filter=latest" class="filter-tab <%= filter === 'latest' ? 'filter-tab--active' : '' %>">
          Leg√∫jabb
        </a>
      </div>
      
      <% if (posts.length > 0) { %>
        <div class="result-count">
          <span class="result-count__number"><%= totalPosts || posts.length %></span>
          <span>cikk</span>
        </div>
      <% } %>
    </div>
    
    <div class="content-layout">
      
      <!-- Main Content -->
      <main class="content-layout__main">
        <% if (posts.length === 0) { %>
          <!-- Empty State -->
          <div class="empty-state">
            <div class="empty-state__icon">üì≠</div>
            <h2 class="empty-state__title">Nincs megjelen√≠thet≈ë cikk</h2>
            <p class="empty-state__description">
              Jelenleg nincsenek publik√°lt cikkek ebben a kateg√≥ri√°ban. K√©rj√ºk, l√°togass vissza k√©s≈ëbb vagy n√©zd meg a t√∂bbi kateg√≥ri√°t.
            </p>
            <div class="empty-state__action">
              <a href="<%= basePath %>" class="btn btn--primary">
                Vissza a kezd≈ëlapra
              </a>
            </div>
          </div>
        <% } else { %>
          
          <!-- Featured Post (csak els≈ë oldalon) -->
          <% if (currentPage === 1 && featuredPost) { %>
            <article class="featured-post">
              <% if (featuredPost.featuredImage) { %>
                <a href="<%= basePath %>blog/<%= featuredPost.slug %>" class="featured-post__image">
                  <img 
                    src="<%= featuredPost.featuredImage %>" 
                    alt="<%= featuredPost.featuredImageAlt || featuredPost.title %>"
                    loading="eager"
                  >
                </a>
              <% } %>
              
              <div class="featured-post__content">
                <% if (featuredPost.category) { %>
                  <div class="featured-post__badge">
                    ‚≠ê Kiemelt: <%= featuredPost.category.name %>
                  </div>
                <% } %>
                
                <h2 class="featured-post__title">
                  <a href="<%= basePath %>blog/<%= featuredPost.slug %>">
                    <%= featuredPost.title %>
                  </a>
                </h2>
                
                <% if (featuredPost.excerpt) { %>
                  <p class="featured-post__excerpt">
                    <%= featuredPost.excerpt %>
                  </p>
                <% } %>
                
                <div class="meta-list mb-4">
                  <span class="meta-item">
                    <svg class="icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                    </svg>
                    <%= featuredPost.author.name %>
                  </span>
                  <span class="meta-item">
                    <svg class="icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                    </svg>
                    <%= new Date(featuredPost.publishedAt).toLocaleDateString('hu-HU') %>
                  </span>
                  <% if (featuredPost.readingTime) { %>
                    <span class="meta-item">
                      <svg class="icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                      </svg>
                      <%= featuredPost.readingTime %> perc
                    </span>
                  <% } %>
                </div>
                
                <a href="<%= basePath %>blog/<%= featuredPost.slug %>" class="btn btn--primary">
                  Teljes cikk olvas√°sa ‚Üí
                </a>
              </div>
            </article>
          <% } %>
          
          <!-- No results message (client-side search) -->
          <div class="empty-state" id="blog-no-results" style="display: none;">
            <div class="empty-state__icon">üîç</div>
            <h2 class="empty-state__title">Nincs tal√°lat</h2>
            <p class="empty-state__description">
              A keres√©si felt√©telnek nem felel meg egyetlen cikk sem. Pr√≥b√°lj meg m√°s kifejez√©st keresni!
            </p>
          </div>
          
          <!-- Posts Grid -->
          <div class="card__grid card__grid--2">
            <% 
            const displayPosts = (currentPage === 1 && posts.length > 0 && featuredPost && featuredPost.featured) 
              ? posts.slice(1) 
              : posts;
            %>
            <% displayPosts.forEach(post => { %>
              <article class="card card--hover">
                
                <!-- Card Image -->
                <% if (post.featuredImage) { %>
                  <a href="<%= basePath %>blog/<%= post.slug %>" class="card__image">
                    <img 
                      src="<%= post.featuredImage %>" 
                      alt="<%= post.featuredImageAlt || post.title %>"
                      loading="lazy"
                    >
                  </a>
                <% } %>

                <!-- Card Content -->
                <div class="card__body">
                  
                  <!-- Category Badge -->
                  <% if (post.category) { %>
                    <a href="<%= basePath %>blog/kategoria/<%= post.category.slug %>" class="badge badge--primary">
                      <%= post.category.name %>
                    </a>
                  <% } %>

                  <!-- Title -->
                  <h2 class="card__title">
                    <a href="<%= basePath %>blog/<%= post.slug %>">
                      <%= post.title %>
                    </a>
                  </h2>

                  <!-- Excerpt -->
                  <% if (post.excerpt) { %>
                    <p class="text-muted text-clamp text-clamp--3">
                      <%= post.excerpt %>
                    </p>
                  <% } %>

                  <!-- Meta Info -->
                  <div class="meta-list">
                    <span class="meta-item">
                      <svg class="icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                      </svg>
                      <%= post.author.name %>
                    </span>
                    <span class="meta-item">
                      <svg class="icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                      </svg>
                      <%= new Date(post.publishedAt).toLocaleDateString('hu-HU') %>
                    </span>
                    <% if (post.readingTime) { %>
                      <span class="meta-item">
                        <svg class="icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                        </svg>
                        <%= post.readingTime %> perc
                      </span>
                    <% } %>
                  </div>

                  <!-- Tags -->
                  <% if (post.tags && post.tags.length > 0) { %>
                    <div class="tag-list">
                      <% post.tags.slice(0, 3).forEach(tag => { %>
                        <a href="<%= basePath %>blog/tag/<%= tag.slug %>" class="tag">
                          #<%= tag.name %>
                        </a>
                      <% }); %>
                    </div>
                  <% } %>
                  
                </div>
              </article>
            <% }); %>
          </div>

          <!-- Enhanced Pagination -->
          <% if (totalPages > 1) { %>
            <nav class="pagination pagination--enhanced" aria-label="Lapoz√°s">
              <% if (hasPrevPage) { %>
                <a href="<%= basePath %>blog?page=<%= currentPage - 1 %><%= filter ? '&filter=' + filter : '' %>" class="pagination__item pagination__prev">
                  ‚Üê El≈ëz≈ë
                </a>
              <% } %>

              <% if (currentPage > 3) { %>
                <a href="<%= basePath %>blog?page=1<%= filter ? '&filter=' + filter : '' %>" class="pagination__item">1</a>
                <% if (currentPage > 4) { %>
                  <span class="pagination__ellipsis">...</span>
                <% } %>
              <% } %>
              
              <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                <a 
                  href="<%= basePath %>blog?page=<%= i %><%= filter ? '&filter=' + filter : '' %>" 
                  class="pagination__item <%= i === currentPage ? 'pagination__item--active' : '' %>"
                  <%= i === currentPage ? 'aria-current="page"' : '' %>
                >
                  <%= i %>
                </a>
              <% } %>
              
              <% if (currentPage < totalPages - 2) { %>
                <% if (currentPage < totalPages - 3) { %>
                  <span class="pagination__ellipsis">...</span>
                <% } %>
                <a href="<%= basePath %>blog?page=<%= totalPages %><%= filter ? '&filter=' + filter : '' %>" class="pagination__item"><%= totalPages %></a>
              <% } %>

              <% if (hasNextPage) { %>
                <a href="<%= basePath %>blog?page=<%= currentPage + 1 %><%= filter ? '&filter=' + filter : '' %>" class="pagination__item pagination__next">
                  K√∂vetkez≈ë ‚Üí
                </a>
              <% } %>
            </nav>
          <% } %>
          
        <% } %>
      </main>

      <!-- Sidebar -->
      <aside class="content-layout__sidebar">
        
        <!-- Newsletter Widget -->
        <div class="newsletter newsletter--compact">
          <h3 class="newsletter__title">üìß H√≠rlev√©l</h3>
          <p class="newsletter__description">
            Iratkozz fel, hogy els≈ëk√©nt √©rtes√ºlj az √∫j cikkekr≈ël!
          </p>
          <form method="POST" action="<%= basePath %>newsletter/subscribe" class="newsletter__form">
            <input 
              type="email" 
              name="email" 
              placeholder="Email c√≠med" 
              required 
              class="newsletter__input"
            >
            <button type="submit" class="newsletter__button">
              Feliratkoz√°s
            </button>
          </form>
        </div>
        
        <!-- RSS Feed -->
        <div class="card">
          <div class="card__body">
            <a href="<%= basePath %>blog/rss" class="rss-link" target="_blank" rel="noopener">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/>
              </svg>
              RSS Feed
            </a>
          </div>
        </div>
        
        <!-- Author Bio Widget -->
        <% if (author) { %>
          <div class="author-bio author-bio--compact">
            <% if (author.avatar) { %>
              <div class="author-bio__avatar">
                <img src="<%= author.avatar %>" alt="<%= author.name %>">
              </div>
            <% } %>
            <div class="author-bio__content">
              <h3 class="author-bio__name"><%= author.name %></h3>
              <% if (author.role) { %>
                <p class="author-bio__role"><%= author.role %></p>
              <% } %>
              <% if (author.bio) { %>
                <p class="author-bio__description"><%= author.bio %></p>
              <% } %>
              <% if (author.social) { %>
                <div class="author-bio__social">
                  <% if (author.social.facebook) { %>
                    <a href="<%= author.social.facebook %>" target="_blank" rel="noopener" class="author-bio__social-link" aria-label="Facebook">
                      <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                      </svg>
                    </a>
                  <% } %>
                  <% if (author.social.twitter) { %>
                    <a href="<%= author.social.twitter %>" target="_blank" rel="noopener" class="author-bio__social-link" aria-label="Twitter">
                      <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                      </svg>
                    </a>
                  <% } %>
                  <% if (author.social.linkedin) { %>
                    <a href="<%= author.social.linkedin %>" target="_blank" rel="noopener" class="author-bio__social-link" aria-label="LinkedIn">
                      <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                      </svg>
                    </a>
                  <% } %>
                </div>
              <% } %>
            </div>
          </div>
        <% } %>
        
        <!-- Archive Widget -->
        <% if (archive && archive.length > 0) { %>
          <div class="card">
            <div class="card__header">
              <h3 class="card__title">Arch√≠vum</h3>
            </div>
            <div class="card__body">
              <ul class="archive-list">
                <% archive.forEach(item => { %>
                  <li class="archive-item">
                    <a href="<%= basePath %>blog/archive/<%= item.year %>/<%= item.month %>" class="archive-link">
                      <span class="archive-link__text">
                        <svg class="archive-link__icon" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                        <%= item.label %>
                      </span>
                      <span class="archive-link__count"><%= item.count %></span>
                    </a>
                  </li>
                <% }); %>
              </ul>
            </div>
          </div>
        <% } %>
        
        <!-- Categories Widget -->
        <% if (categories && categories.length > 0) { %>
          <div class="card">
            <div class="card__header">
              <h3 class="card__title">Kateg√≥ri√°k</h3>
            </div>
            <div class="card__body">
              <ul class="list-unstyled list-spacing--sm">
                <% categories.forEach(category => { %>
                  <li>
                    <a href="<%= basePath %>blog/kategoria/<%= category.slug %>" class="link-hover">
                      <%= category.name %>
                    </a>
                  </li>
                <% }); %>
              </ul>
            </div>
          </div>
        <% } %>

        <!-- Popular Posts Widget -->
        <% if (popularPosts && popularPosts.length > 0) { %>
          <div class="card">
            <div class="card__header">
              <h3 class="card__title">N√©pszer≈± cikkek</h3>
            </div>
            <div class="card__body">
              <ul class="list-unstyled list-spacing--md">
                <% popularPosts.forEach(popular => { %>
                  <li class="media-object">
                    <a href="<%= basePath %>blog/<%= popular.slug %>" class="media-object__link">
                      <% if (popular.featuredImage) { %>
                        <img 
                          src="<%= popular.featuredImage %>" 
                          alt="<%= popular.title %>"
                          class="media-object__image"
                          loading="lazy"
                        >
                      <% } %>
                      <div class="media-object__content">
                        <h4 class="media-object__title text-clamp text-clamp--2">
                          <%= popular.title %>
                        </h4>
                        <span class="text-muted text-sm">
                          <%= popular.viewCount %> megtekint√©s
                        </span>
                      </div>
                    </a>
                  </li>
                <% }); %>
              </ul>
            </div>
          </div>
        <% } %>

        <!-- Popular Tags Widget -->
        <% if (popularTags && popularTags.length > 0) { %>
          <div class="card">
            <div class="card__header">
              <h3 class="card__title">N√©pszer≈± c√≠mk√©k</h3>
            </div>
            <div class="card__body">
              <div class="tag-list">
                <% popularTags.forEach(tag => { %>
                  <a href="<%= basePath %>blog/tag/<%= tag.slug %>" class="tag">
                    <%= tag.name %>
                  </a>
                <% }); %>
              </div>
            </div>
          </div>
        <% } %>
        
      </aside>
      
    </div>
  </div>
</section>

<!-- Page-specific JavaScript -->
<script src="<%= basePath %>js/blog-search.js"></script>
