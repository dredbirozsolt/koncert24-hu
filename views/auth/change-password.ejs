
<section class="section">
    <div class="max-w-2xl mx-auto">
        <% if (typeof error !== 'undefined' && error) { %>
            <div class="alert alert--error mb-6">
                <div class="alert__icon">‚ö†Ô∏è</div>
                <div class="alert__content">
                    <p class="alert__message">
                        <% if (error === 'current_password' || error === 'invalid_old_password') { %>
                            Hib√°s jelenlegi jelsz√≥. K√©rj√ºk, pr√≥b√°ld √∫jra.
                        <% } else if (error === 'password_mismatch') { %>
                            Az √∫j jelszavak nem egyeznek.
                        <% } else if (error === 'weak_password') { %>
                            A jelsz√≥ nem el√©g er≈ës. K√©rj√ºk, k√∂vesd az al√°bbi k√∂vetelm√©nyeket.
                        <% } else if (error === 'validation') { %>
                            K√©rj√ºk, t√∂ltsd ki helyesen az √∂sszes mez≈ët.
                        <% } else { %>
                            <%= error %>
                        <% } %>
                    </p>
                </div>
            </div>
        <% } %>

        <% if (typeof success !== 'undefined' && success) { %>
            <div class="alert alert--success mb-6">
                <div class="alert__icon">‚úÖ</div>
                <div class="alert__content">
                    <p class="alert__message">
                        Jelsz√≥ sikeresen m√≥dos√≠tva! Email √©rtes√≠t√©st k√ºldt√ºnk a m√≥dos√≠t√°sr√≥l.
                    </p>
                </div>
            </div>
        <% } %>

        <div class="card">
            <div class="card__header">
                <h2 class="card__title">üîë Jelsz√≥ m√≥dos√≠t√°sa</h2>
            </div>
            
            <div class="card__body">
                <div class="alert alert--info mb-6">
                    <div class="alert__icon">üîê</div>
                    <div class="alert__content">
                        <p class="alert__message">
                            <strong>Biztons√°gi inform√°ci√≥:</strong> A jelsz√≥ m√≥dos√≠t√°sa ut√°n az √∂sszes akt√≠v munkamenet (kiv√©ve a jelenlegi) automatikusan ki lesz jelentkeztetve. Email √©rtes√≠t√©st fogsz kapni a v√°ltoz√°sr√≥l.
                        </p>
                    </div>
                </div>

                <form method="POST" action="<%= basePath %>auth/profile/change-password" x-data="passwordForm()">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    
                    <div class="form__group">
                        <label for="currentPassword" class="form__label">
                            üîí Jelenlegi jelsz√≥
                        </label>
                        <div class="form__input-group form__input-group--icon-right">
                            <input 
                                x-bind:type="showCurrent ? 'text' : 'password'"
                                id="currentPassword" 
                                name="currentPassword" 
                                class="form__input"
                                required
                                autocomplete="current-password"
                            />
                            <button 
                                type="button" 
                                class="form__input-icon-right btn-unstyled text-primary-600 text-sm"
                                x-on:click="showCurrent = !showCurrent"
                                x-text="showCurrent ? 'Elrejt' : 'Mutat'"
                                tabindex="-1"
                            ></button>
                        </div>
                    </div>

                    <div class="form__group">
                        <label for="newPassword" class="form__label">
                            üîë √öj jelsz√≥
                        </label>
                        <div class="form__input-group form__input-group--icon-right">
                            <input 
                                x-bind:type="showNew ? 'text' : 'password'"
                                id="newPassword" 
                                name="newPassword" 
                                class="form__input"
                                required
                                minlength="8"
                                autocomplete="new-password"
                                x-on:input="validatePassword($event.target.value)"
                            />
                            <button 
                                type="button" 
                                class="form__input-icon-right btn-unstyled text-primary-600 text-sm"
                                x-on:click="showNew = !showNew"
                                x-text="showNew ? 'Elrejt' : 'Mutat'"
                                tabindex="-1"
                            ></button>
                        </div>
                    </div>

                    <div class="form__group">
                        <label for="confirmPassword" class="form__label">
                            ‚úì √öj jelsz√≥ meger≈ës√≠t√©se
                        </label>
                        <div class="form__input-group form__input-group--icon-right">
                            <input 
                                x-bind:type="showConfirm ? 'text' : 'password'"
                                id="confirmPassword" 
                                name="confirmPassword" 
                                class="form__input"
                                required
                                minlength="8"
                                autocomplete="new-password"
                            />
                            <button 
                                type="button" 
                                class="form__input-icon-right btn-unstyled text-primary-600 text-sm"
                                x-on:click="showConfirm = !showConfirm"
                                x-text="showConfirm ? 'Elrejt' : 'Mutat'"
                                tabindex="-1"
                            ></button>
                        </div>
                    </div>

                    <div class="alert alert--info">
                        <div class="alert__icon">üìã</div>
                        <div class="alert__content">
                            <p class="alert__message">
                                <strong>Jelsz√≥ k√∂vetelm√©nyek:</strong>
                            </p>
                            <ul class="list-disc ml-5 mt-2 space-y-1 text-sm">
                                <li>Legal√°bb 8 karakter</li>
                                <li>Kis- √©s nagybet≈±</li>
                                <li>Legal√°bb egy sz√°m</li>
                            </ul>
                        </div>
                    </div>

                    <div class="flex gap-3 mt-6">
                        <button type="submit" class="btn btn--primary flex-1" :disabled="!isValid">
                            üíæ Jelsz√≥ ment√©se
                        </button>
                        <a href="<%= basePath %>auth/profile" class="btn btn--outline flex-1">
                            ‚Üê Vissza
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<script>
function passwordForm() {
    return {
        showCurrent: false,
        showNew: false,
        showConfirm: false,
        isValid: true,
        
        validatePassword(password) {
            const hasMinLength = password.length >= 8;
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasNumber = /\d/.test(password);
            
            this.isValid = hasMinLength && hasUpperCase && hasLowerCase && hasNumber;
        }
    };
}
</script>
