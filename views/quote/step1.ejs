<main class="quote-wizard">
  <div class="quote-wizard__container">
    
    <!-- Progress Bar -->
    <div class="quote-wizard__progress">
      <div class="quote-wizard__progress-bar">
        <div class="quote-wizard__progress-fill progress-33"></div>
      </div>
      <div class="quote-wizard__progress-text">1. lépés / 3</div>
    </div>

      <!-- Back Button -->
      <a href="<%= basePath %>eloadok/<%= performer.slug %>" class="btn btn--secondary mb-6">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
        </svg>
        Vissza az előadóhoz
      </a>

      <!-- Performer Card (Mini) -->
      <div class="quote-wizard__performer-card">
        <% if (performer.imageUrl) { %>
          <img src="<%= performer.imageUrl %>" alt="<%= performer.name %>" class="quote-wizard__performer-image">
        <% } %>
        <div class="quote-wizard__performer-info">
          <h3 class="quote-wizard__performer-name"><%= performer.name %></h3>
          <% if (performer.performanceType) { %>
            <span class="quote-wizard__performer-type"><%= performer.performanceType %></span>
          <% } %>
        </div>
      </div>

      <!-- Step Title -->
      <h1 class="quote-wizard__title">Mesélj kicsit az eseményedről!</h1>
      <p class="quote-wizard__subtitle">Adj meg néhány alapvető információt a rendezvényedről.</p>

      <!-- Form -->
      <form id="step1-form" class="quote-wizard__form">
        
        <!-- Date -->
        <div class="form-group">
          <label for="eventDate" class="form-label">
            Melyik napon rendeznéd az eseményt? <span class="required">*</span>
          </label>
          <div class="date-picker" x-data="quoteDatePicker()" x-init="init()">
            <div class="selected-date-display" @click="showCalendar = !showCalendar" tabindex="0">
              <div class="date-display">
                <span x-show="!selectedDate" class="placeholder">Válassz dátumot</span>
                <span x-show="selectedDate" class="selected-date-text" x-text="formatSelectedDate()"></span>
              </div>
              <svg class="dropdown-icon" :class="{ 'rotate-180': showCalendar }" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </div>
            
            <!-- Calendar Popup -->
            <div x-show="showCalendar" 
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0 scale-95"
              x-transition:enter-end="opacity-100 scale-100"
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100 scale-100"
              x-transition:leave-end="opacity-0 scale-95"
              @click.outside="showCalendar = false" 
              class="calendar-popup">
              <!-- Calendar Header -->
              <div class="calendar-header">
                <button type="button" @click="previousMonth()" class="nav-button">
                  <svg viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
                <h3 class="month-year" x-text="formatMonthYear()"></h3>
                <button type="button" @click="nextMonth()" class="nav-button">
                  <svg viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
              </div>
              
              <!-- Days of Week -->
              <div class="weekdays">
                <div class="weekday">H</div>
                <div class="weekday">K</div>
                <div class="weekday">Sze</div>
                <div class="weekday">Cs</div>
                <div class="weekday">P</div>
                <div class="weekday">Szo</div>
                <div class="weekday">V</div>
              </div>
              
              <!-- Calendar Grid -->
              <div class="calendar-grid">
                <template x-for="date in calendarDates" :key="date.key">
                  <button type="button" @click="selectDate(date)" :disabled="date.disabled" :class="{'calendar-day': true, 'other-month': date.otherMonth, 'selected': date.selected, 'today': date.today, 'disabled': date.disabled}" x-text="date.day"></button>
                </template>
              </div>
            </div>
          </div>
          <label class="checkbox-label">
            <input type="checkbox" name="eventDateFlexible" id="eventDateFlexible" <%= quoteData.eventDateFlexible ? 'checked' : '' %>>
            <span>Nem fix még az esemény dátuma</span>
          </label>
          <input type="hidden" name="eventDate" id="eventDate" value="<%= quoteData.eventDate || '' %>" required>
        </div>

        <!-- Time -->
        <div class="form-group">
          <label for="eventTime" class="form-label">
            Hány órakor kezdődjön az esemény? <span class="required">*</span>
          </label>
          <div class="time-picker" x-data="quoteTimePicker()" x-init="init()">
            <div class="selected-time-display" @click="showTimePicker = !showTimePicker" tabindex="0">
              <div class="time-display">
                <span x-show="!selectedHour && !selectedMinute" class="placeholder">Válassz időpontot</span>
                <span x-show="selectedHour !== null && selectedMinute !== null" class="selected-time-text" x-text="selectedHour + ':' + selectedMinute"></span>
              </div>
              <svg class="dropdown-icon" :class="{ 'rotate-180': showTimePicker }" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </div>
            
            <!-- Time Picker Popup -->
            <div x-show="showTimePicker" 
              x-transition:enter="transition ease-out duration-200"
              x-transition:enter-start="opacity-0 scale-95"
              x-transition:enter-end="opacity-100 scale-100"
              x-transition:leave="transition ease-in duration-150"
              x-transition:leave-start="opacity-100 scale-100"
              x-transition:leave-end="opacity-0 scale-95"
              @click.outside="handleTimePickerClose()" 
              class="time-picker-popup">
              <h4 class="time-title">Időpont kiválasztása</h4>
              <div class="time-picker-container">
                <!-- Hour Wheel -->
                <div class="wheel-picker hour-wheel">
                  <div class="wheel-label">Óra</div>
                  <div class="wheel-container" @wheel.prevent="handleHourWheel($event)" @touchstart="handleHourTouchStart($event)" @touchmove.prevent="handleHourTouchMove($event)" @touchend="handleHourTouchEnd($event)">
                    <div class="wheel-mask">
                      <div class="wheel-selection-overlay"></div>
                      <div class="wheel-items" :style="`transform: translateY(${hourOffset}px)`">
                        <template x-for="(hour, index) in availableHours" :key="index">
                          <div class="wheel-item" :class="{ 'selected': index === selectedHourIndex }" @click="selectHour(index)" x-text="hour"></div>
                        </template>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="time-separator-wheel">:</div>

                <!-- Minute Wheel -->
                <div class="wheel-picker minute-wheel">
                  <div class="wheel-label">Perc</div>
                  <div class="wheel-container" @wheel.prevent="handleMinuteWheel($event)" @touchstart="handleMinuteTouchStart($event)" @touchmove.prevent="handleMinuteTouchMove($event)" @touchend="handleMinuteTouchEnd($event)">
                    <div class="wheel-mask">
                      <div class="wheel-selection-overlay"></div>
                      <div class="wheel-items" :style="`transform: translateY(${minuteOffset}px)`">
                        <template x-for="(minute, index) in availableMinutes" :key="index">
                          <div class="wheel-item" :class="{ 'selected': index === selectedMinuteIndex }" @click="selectMinute(index)" x-text="minute"></div>
                        </template>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="time-picker-actions">
                <button type="button" @click="confirmTime()" class="confirm-btn">Időpont megerősítése</button>
              </div>
            </div>
          </div>
          <input type="hidden" name="eventTime" id="eventTime" value="<%= quoteData.eventTime || '' %>" required>
          
          <!-- Time Flexible Checkbox -->
          <div class="form-group-inline mt-3">
            <label class="checkbox-label">
              <input type="checkbox" name="eventTimeFlexible" id="eventTimeFlexible" <%= quoteData.eventTimeFlexible ? 'checked' : '' %>>
              <span>Még nem fix az időpont</span>
            </label>
          </div>
        </div>

        <!-- Location -->
        <div class="form-group">
          <label for="eventLocation" class="form-label">
            Hol rendeznéd az eseményt? <span class="required">*</span>
          </label>
          <div class="location-search" x-data="quoteLocationSearch()" x-init="query = '<%= quoteData.eventLocation || '' %>'">
            <input 
              type="text" 
              class="form-input" 
              placeholder="Írd be a helységnevet" 
              x-model="query"
              @input="handleInput()" 
              @focus="showSuggestions = true" 
              @blur="hideSuggestions()"
              @keydown.arrow-down.prevent="highlightNext()" 
              @keydown.arrow-up.prevent="highlightPrevious()"
              @keydown.enter.prevent="selectHighlighted()" 
              @keydown.escape="hideSuggestions()" 
              autocomplete="off">
            <div class="location-suggestions" x-show="showSuggestions && suggestions.length > 0" x-transition>
              <template x-for="(suggestion, index) in suggestions" :key="index">
                <div class="suggestion-item" 
                  :class="{ 'highlighted': index === highlightedIndex }"
                  @mousedown.prevent="selectLocation(suggestion)" 
                  @mouseenter="highlightedIndex = index">
                  <div class="suggestion-name" x-text="suggestion.name"></div>
                  <div class="suggestion-country" x-text="suggestion.country"></div>
                </div>
              </template>
            </div>
          </div>
          <input type="hidden" name="eventLocation" id="eventLocation" value="<%= quoteData.eventLocation || '' %>" required>
        </div>

        <!-- Event Type (singular) -->
        <div class="form-group">
          <label for="eventType" class="form-label">
            Milyen műsor típusú eseményt szeretnél rendezni? <span class="required">*</span>
          </label>
          <select name="eventType" id="eventType" class="form-input" required>
            <option value="">Válassz műsor típust</option>
            <option value="outdoor_free" <%= quoteData.eventType === 'outdoor_free' ? 'selected' : '' %>>Nyilvános ingyenes rendezvény szabadtéren</option>
            <option value="outdoor_paid" <%= quoteData.eventType === 'outdoor_paid' ? 'selected' : '' %>>Nyilvános belépőjegyes rendezvény szabadtéren</option>
            <option value="indoor_free" <%= quoteData.eventType === 'indoor_free' ? 'selected' : '' %>>Nyilvános ingyenes rendezvény zárt helyiségben</option>
            <option value="indoor_paid" <%= quoteData.eventType === 'indoor_paid' ? 'selected' : '' %>>Nyilvános belépőjegyes rendezvény zárt helyiségben</option>
            <option value="private_personal" <%= quoteData.eventType === 'private_personal' ? 'selected' : '' %>>Zártkörű magánrendezvény</option>
            <option value="private_corporate" <%= quoteData.eventType === 'private_corporate' ? 'selected' : '' %>>Zártkörű céges rendezvény</option>
          </select>
        </div>

        <!-- Guest Count -->
        <div class="form-group">
          <label class="form-label">
            Várható vendégszám <span class="required">*</span>
          </label>
          <div class="radio-group">
            <label class="radio-card">
              <input type="radio" name="guestCount" value="<100" <%= quoteData.guestCount === '<100' ? 'checked' : '' %> required>
              <span>Kevesebb mint 100 fő</span>
            </label>
            <label class="radio-card">
              <input type="radio" name="guestCount" value="100-300" <%= quoteData.guestCount === '100-300' ? 'checked' : '' %>>
              <span>100 - 300 fő</span>
            </label>
            <label class="radio-card">
              <input type="radio" name="guestCount" value="300-800" <%= quoteData.guestCount === '300-800' ? 'checked' : '' %>>
              <span>300 - 800 fő</span>
            </label>
            <label class="radio-card">
              <input type="radio" name="guestCount" value="800+" <%= quoteData.guestCount === '800+' ? 'checked' : '' %>>
              <span>800+ fő</span>
            </label>
          </div>
        </div>

        <!-- Event Name -->
        <div class="form-group">
          <label for="eventName" class="form-label">
            Rendezvény elnevezése <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="eventName" 
            name="eventName" 
            class="form-input" 
            placeholder="Pl. Eperfesztivál, Ballagás, Karácsonyi buli"
            value="<%= quoteData.eventName || '' %>" 
            required>
        </div>

        <!-- Event Category -->
        <div class="form-group">
          <label for="eventCategory" class="form-label">
            Esemény jellege <span class="required">*</span>
          </label>
          <select id="eventCategory" name="eventCategory" class="form-input" required>
            <option value="">Válassz kategóriát</option>
            <option value="magánrendezvény" <%= quoteData.eventCategory === 'magánrendezvény' ? 'selected' : '' %>>Magánrendezvény</option>
            <option value="céges rendezvény" <%= quoteData.eventCategory === 'céges rendezvény' ? 'selected' : '' %>>Céges rendezvény</option>
            <option value="falunap" <%= quoteData.eventCategory === 'falunap' ? 'selected' : '' %>>Falunap</option>
            <option value="fesztivál" <%= quoteData.eventCategory === 'fesztivál' ? 'selected' : '' %>>Fesztivál</option>
            <option value="városi ünnep" <%= quoteData.eventCategory === 'városi ünnep' ? 'selected' : '' %>>Városi ünnep</option>
            <option value="iskolai rendezvény" <%= quoteData.eventCategory === 'iskolai rendezvény' ? 'selected' : '' %>>Iskolai rendezvény</option>
            <option value="egyéb" <%= quoteData.eventCategory === 'egyéb' ? 'selected' : '' %>>Egyéb</option>
          </select>
        </div>

        <!-- Submit Button -->
        <div class="form-actions form-actions--split">
          <a href="<%= basePath %>eloadok/<%= performer.slug %>" class="btn btn--secondary btn--large">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
            </svg>
            Vissza az előadóhoz
          </a>
          <button type="submit" class="btn btn--primary btn--large">
            Tovább a következő lépésre
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          </button>
        </div>

      </form>

    </div>
  </main>

  <!-- Custom CSS for this page -->
  <link rel="stylesheet" href="<%= basePath %>css/pages/quote-wizard.css">
  <link rel="stylesheet" href="<%= basePath %>css/modules/booking-system.css">
  
  <!-- Custom JS for this page -->
  <script src="<%= basePath %>js/pages/quote-date-picker.js"></script>
  <script src="<%= basePath %>js/pages/quote-time-picker.js"></script>
  <script src="<%= basePath %>js/pages/quote-location-search.js"></script>
  <script src="<%= basePath %>js/pages/quote-wizard.js"></script>
  
  <script>
    // Handle time flexible checkbox
    document.addEventListener('DOMContentLoaded', function() {
      const timeFlexibleCheckbox = document.getElementById('eventTimeFlexible');
      const timeInput = document.getElementById('eventTime');
      const timeDisplay = document.querySelector('.selected-time-display');
      
      if (timeFlexibleCheckbox && timeDisplay) {
        function updateTimeInputState() {
          if (timeFlexibleCheckbox.checked) {
            timeInput.required = false;
            // Don't clear the value - keep it for display purposes
            timeDisplay.style.opacity = '0.5';
            timeDisplay.style.pointerEvents = 'none';
            timeDisplay.style.cursor = 'not-allowed';
          } else {
            timeInput.required = true;
            timeDisplay.style.opacity = '1';
            timeDisplay.style.pointerEvents = 'auto';
            timeDisplay.style.cursor = 'pointer';
          }
        }
        
        // Initialize state
        updateTimeInputState();
        
        // Listen for checkbox changes
        timeFlexibleCheckbox.addEventListener('change', updateTimeInputState);
      }
    });
  </script>
