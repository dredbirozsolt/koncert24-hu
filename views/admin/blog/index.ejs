<!-- Admin Blog Management -->


<div class="page-container">
    <% if (typeof success !== 'undefined') { %>
        <% if (success === 'created') { %>
            <div class="alert alert-success">‚úì Cikk sikeresen l√©trehozva!</div>
        <% } else if (success === 'updated') { %>
            <div class="alert alert-success">‚úì Cikk sikeresen friss√≠tve!</div>
        <% } else if (success === 'deleted') { %>
            <div class="alert alert-success">‚úì Cikk sikeresen t√∂r√∂lve!</div>
        <% } %>
    <% } %>

    <!-- 2-Column Grid Layout -->
    <div class="admin-two-col">
        
        <!-- Left Column: Main Content -->
        <div>

    <!-- Statistics -->
    <div class="card--data">
        <h3>üìä Blog Statisztik√°k</h3>
        <div class="stats-grid">
            <div class="card--stat card--stat--success">
                <h3>üìù Publik√°lt</h3>
                <div class="stat-value"><%= posts.filter(p => p.status === 'published').length %></div>
            </div>
            <div class="card--stat card--stat--primary">
                <h3>‚è±Ô∏è Id≈ëz√≠tett</h3>
                <div class="stat-value"><%= posts.filter(p => p.status === 'scheduled').length %></div>
            </div>
            <div class="card--stat card--stat--warning">
                <h3>üìù Piszkozat</h3>
                <div class="stat-value"><%= posts.filter(p => p.status === 'draft').length %></div>
            </div>
            <div class="card--stat card--stat--primary">
                <h3>üìä √ñsszes</h3>
                <div class="stat-value"><%= posts.length %></div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="card--filter">
        <form method="GET" action="/admin/blog">
            <div class="filter-grid-inline">
                <div class="form__group">
                    <label>Keres√©s</label>
                    <input type="text" name="search" class="form__control"
                           placeholder="C√≠m vagy le√≠r√°s..."
                           value="<%= search %>">
                </div>
                <div class="form__group">
                    <label>St√°tusz</label>
                    <select name="status" class="form__select">
                        <option value="all" <%= status === 'all' ? 'selected' : '' %>>√ñsszes</option>
                        <option value="published" <%= status === 'published' ? 'selected' : '' %>>Publik√°lt</option>
                        <option value="scheduled" <%= status === 'scheduled' ? 'selected' : '' %>>‚è±Ô∏è Id≈ëz√≠tett</option>
                        <option value="draft" <%= status === 'draft' ? 'selected' : '' %>>Piszkozat</option>
                        <option value="archived" <%= status === 'archived' ? 'selected' : '' %>>Archiv√°lt</option>
                    </select>
                </div>
                <div class="form__group">
                    <label>&nbsp;</label>
                    <button type="submit" class="btn btn--primary w-full">
                        üîç Sz≈±r√©s
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Action Buttons -->
    <div class="btn__group btn__group--equal mb-4">
        <a href="/admin/blog/categories" class="btn btn--secondary">
            üìÅ Kateg√≥ri√°k
        </a>
        <a href="/admin/blog/tags" class="btn btn--secondary">
            üè∑Ô∏è C√≠mk√©k
        </a>
        <a href="/admin/blog/new" class="btn btn--primary">
            + √öj Cikk
        </a>
    </div>

    <!-- Blog Posts -->
    <div class="card--data">
        <% if (posts.length === 0) { %>
            <div class="empty-state">
                <h3>üòï Nincs megjelen√≠thet≈ë cikk</h3>
                <p>Pr√≥b√°ljon m√°s sz≈±r√©si felt√©teleket vagy hozzon l√©tre az els≈ë cikket.</p>
                <a href="/admin/blog/new" class="btn btn--primary mt-2">
                    Els≈ë cikk l√©trehoz√°sa
                </a>
            </div>
        <% } else { %>
            <div class="table--responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>K√©p</th>
                            <th>C√≠m</th>
                            <th>St√°tusz</th>
                            <th>M≈±veletek</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% posts.forEach(post => { %>
                            <tr>
                                <td data-label="K√©p">
                                    <% if (post.featuredImage) { %>
                                        <img src="<%= post.featuredImage %>" 
                                             alt="<%= post.title %>" 
                                             title="<%= post.title %>" 
                                             class="table__avatar w-15 h-15 object-cover rounded-lg">
                                    <% } else { %>
                                        <div class="table__avatar-placeholder w-15 h-15 rounded-lg text-2xl">
                                            üìù
                                        </div>
                                    <% } %>
                                </td>
                                <td data-label="C√≠m">
                                    <strong><%= post.title %></strong>
                                </td>
                                <td data-label="St√°tusz">
                                    <% if (post.status === 'published') { %>
                                        <span class="badge badge-success">
                                            Publik√°lt
                                        </span>
                                    <% } else if (post.status === 'scheduled') { %>
                                        <span class="badge badge-info">
                                            Id≈ëz√≠tett
                                        </span>
                                        <% if (post.publishedAt) { %>
                                            <br><small class="text-secondary text-xs">
                                                <%= new Date(post.publishedAt).toLocaleString('hu-HU', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
                                            </small>
                                        <% } %>
                                    <% } else if (post.status === 'archived') { %>
                                        <span class="badge badge-secondary">
                                            Archiv√°lt
                                        </span>
                                    <% } else { %>
                                        <span class="badge badge-warning">
                                            Piszkozat
                                        </span>
                                    <% } %>
                                </td>
                                <td data-label="M≈±veletek">
                                    <div class="actions">
                                        <a href="/blog/<%= post.slug %>" target="_blank" class="btn btn-icon-only btn--primary" title="Megtekint√©s">
                                            üëÅ
                                        </a>
                                        <a href="/admin/blog/<%= post.id %>/edit" class="btn btn-icon-only btn--secondary" title="Szerkeszt√©s">
                                            ‚úèÔ∏è
                                        </a>
                                        <button class="btn btn-icon-only btn-error delete-post" 
                                                data-id="<%= post.id %>" 
                                                data-title="<%= post.title %>"
                                                title="T√∂rl√©s">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>

            <% if (totalPages > 1) { %>
                <div class="p-6 flex justify-center gap-2 items-center">
                    <% if (hasPrevPage) { %>
                        <a href="?page=<%= currentPage - 1 %>&status=<%= status %>&search=<%= search %>" class="btn btn--secondary">‚Üê El≈ëz≈ë</a>
                    <% } %>
                    <span class="px-4 text-muted font-medium">
                        <%= currentPage %> / <%= totalPages %>
                    </span>
                    <% if (hasNextPage) { %>
                        <a href="?page=<%= currentPage + 1 %>&status=<%= status %>&search=<%= search %>" class="btn btn--secondary">K√∂vetkez≈ë ‚Üí</a>
                    <% } %>
                </div>
            <% } %>
        <% } %>
    </div>

        </div>
        <!-- End of Left Column -->

        <!-- Right Column: Info Boxes -->
        <div>
            
            <!-- Info Box 1: St√°tusz T√≠pusok -->
            <div class="card--data">
                <h3>üìã St√°tusz T√≠pusok</h3>
                <div class="card__info-content">
                    <p><strong class="text-success">‚úÖ Publik√°lt:</strong> A cikk √©l≈ëben van, mindenki l√°thatja a weboldalon</p>
                    <p><strong class="text-primary">‚è±Ô∏è Id≈ëz√≠tett:</strong> A cikk automatikusan publik√°l√≥dik a be√°ll√≠tott id≈ëpontban</p>
                    <p><strong class="text-warning">üìù Piszkozat:</strong> M√©g nem publik√°lt cikk, csak adminok l√°tj√°k</p>
                    <p><strong class="text-secondary">üì¶ Archiv√°lt:</strong> R√©gi cikk, m√°r nem jelenik meg, de meg≈ërz√∂tt</p>
                </div>
            </div>

            <!-- Info Box 2: SEO Best Practices -->
            <div class="card--data">
                <h3>üîç SEO Legjobb Gyakorlatok</h3>
                <div class="card__info-content">
                    <ul>
                        <li><strong>C√≠m:</strong> Legyen r√∂vid (50-60 karakter), tartalmazza a kulcssz√≥t</li>
                        <li><strong>Meta le√≠r√°s:</strong> 150-160 karakter, h√≠vjon cselekv√©sre</li>
                        <li><strong>Slug:</strong> Haszn√°lj k√∂t≈ëjelet, ker√ºld a speci√°lis karaktereket</li>
                        <li><strong>Kiemelt k√©p:</strong> Optim√°lis m√©ret: 1200x630px (Open Graph)</li>
                        <li><strong>Kateg√≥ria:</strong> Mindig adj meg kateg√≥ri√°t a jobb szervez√©s√©rt</li>
                    </ul>
                </div>
            </div>

            <!-- Info Box 3: Id≈ëz√≠tett Publik√°l√°s -->
            <div class="card--data">
                <h3>‚è±Ô∏è Id≈ëz√≠tett Publik√°l√°s</h3>
                <div class="card__info-content">
                    <p>Az id≈ëz√≠tett cikkek automatikusan publik√°l√≥dnak a megadott id≈ëpontban.</p>
                    <p><strong>Hogyan m≈±k√∂dik?</strong></p>
                    <ol>
                        <li>√Åll√≠tsd be a publik√°l√°s d√°tum√°t √©s id≈ëpontj√°t</li>
                        <li>V√°laszd az "Id≈ëz√≠tett" st√°tuszt</li>
                        <li>A rendszer automatikusan publik√°lja a cikket</li>
                    </ol>
                    <p class="text-sm text-secondary mt-4">
                        üí° Tipp: Haszn√°ld h√©tv√©g√©k √©s √ºnnepi id≈ëszakok el≈ëk√©sz√≠t√©s√©re!
                    </p>
                </div>
            </div>

            <!-- Info Box 4: Kateg√≥ri√°k -->
            <div class="card--data">
                <h3>üìÅ Kateg√≥ri√°k</h3>
                <div class="card__info-content">
                    <p>A kateg√≥ri√°k seg√≠tenek szervezni √©s csoportos√≠tani a blog cikkeket.</p>
                    <p><strong>El≈ëny√∂k:</strong></p>
                    <ul>
                        <li>Jobb felhaszn√°l√≥i √©lm√©ny (k√∂nnyebb navig√°ci√≥)</li>
                        <li>SEO el≈ëny√∂k (struktur√°lt tartalom)</li>
                        <li>Sz≈±r√©si lehet≈ës√©gek a l√°togat√≥knak</li>
                    </ul>
                </div>
            </div>

            <!-- Info Box 5: K√©pek √©s M√©dia -->
            <div class="card--data">
                <h3>üñºÔ∏è K√©pek √©s M√©dia</h3>
                <div class="card__info-content">
                    <p><strong>Kiemelt k√©p (Featured Image):</strong></p>
                    <p>Ez a k√©p jelenik meg a blog list√°ban √©s a k√∂z√∂ss√©gi megoszt√°sokn√°l.</p>
                    <p><strong>Aj√°nlott m√©retek:</strong></p>
                    <ul>
                        <li>Kiemelt k√©p: 1200x630px (16:9 ar√°ny)</li>
                        <li>Thumbnail: 400x300px</li>
                        <li>Cikken bel√ºli k√©pek: max 1920px sz√©less√©g</li>
                        <li>F√°jlform√°tum: JPG vagy WebP optimaliz√°lt m√©rettel</li>
                    </ul>
                </div>
            </div>

            <!-- Info Box 6: Tag Aj√°nlatok -->
            <div class="card--data">
                <h3>üè∑Ô∏è N√©pszer≈± Tag-ek</h3>
                <div class="card__info-content">
                    <p class="mb-3">Haszn√°ld ezeket a tag-eket a jobb kategoriz√°l√°s√©rt √©s kereshet≈ës√©g√©rt:</p>
                    
                    <div class="mb-4">
                        <p class="font-semibold text-sm mb-2">üìã √Åltal√°nos</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="badge badge-secondary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#koncertszervez√©s</span>
                            <span class="badge badge-secondary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#rendezv√©nyszervez√©s</span>
                            <span class="badge badge-secondary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#√©l≈ëzene</span>
                            <span class="badge badge-secondary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#fell√©p√©s</span>
                            <span class="badge badge-secondary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#zeneipar</span>
                            <span class="badge badge-secondary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#koncerttippek</span>
                            <span class="badge badge-secondary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#m≈±sorszervez√©s</span>
                            <span class="badge badge-secondary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#produkci√≥</span>
                        </div>
                    </div>

                    <div class="mb-4">
                        <p class="font-semibold text-sm mb-2">üéØ Megrendel≈ëknek</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="badge badge-primary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#c√©gesrendezv√©ny</span>
                            <span class="badge badge-primary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#fesztiv√°l</span>
                            <span class="badge badge-primary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#√∂nkorm√°nyzatiesem√©ny</span>
                            <span class="badge badge-primary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#iskolairendezv√©ny</span>
                            <span class="badge badge-primary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#rendezv√©nyszervez≈ë</span>
                            <span class="badge badge-primary cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#koncertszervez≈ë</span>
                        </div>
                    </div>

                    <div class="mb-4">
                        <p class="font-semibold text-sm mb-2">üé§ El≈ëad√≥knak</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="badge badge-success cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#zen√©sz√©let</span>
                            <span class="badge badge-success cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#el≈ëad√≥ivagyok</span>
                            <span class="badge badge-success cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#fell√©p√©s</span>
                            <span class="badge badge-success cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#showreel</span>
                            <span class="badge badge-success cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#zenekar</span>
                            <span class="badge badge-success cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#m≈±v√©szkarrier</span>
                            <span class="badge badge-success cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#turn√©√©let</span>
                            <span class="badge badge-success cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#√©l≈ëzene</span>
                        </div>
                    </div>

                    <div>
                        <p class="font-semibold text-sm mb-2">üõ†Ô∏è Szakmai</p>
                        <div class="flex flex-wrap gap-2">
                            <span class="badge badge-warning cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#backstage</span>
                            <span class="badge badge-warning cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#koncert√©lm√©ny</span>
                            <span class="badge badge-warning cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#zeneiszakma</span>
                            <span class="badge badge-warning cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#rendezv√©nyst√°b</span>
                            <span class="badge badge-warning cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#hangtechnika</span>
                            <span class="badge badge-warning cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#f√©nytechnika</span>
                            <span class="badge badge-warning cursor-pointer" onclick="copyTag(this)" title="Kattints a m√°sol√°shoz">#produkci√≥menedzsment</span>
                        </div>
                    </div>

                    <p class="text-xs text-secondary mt-4">
                        üí° Tipp: Kattints b√°rmelyik tag-re a v√°g√≥lapra m√°sol√°shoz!
                    </p>
                </div>
            </div>

        </div>
        <!-- End of Right Column -->

    </div>
    <!-- End of Grid -->
</div>

<script>
document.querySelectorAll('.delete-post').forEach(btn => {
    btn.addEventListener('click', async function() {
        const title = this.dataset.title;
        const id = this.dataset.id;
        
        const confirmed = await Modal.confirm({
            title: 'Cikk t√∂rl√©se',
            message: 'Biztosan t√∂r√∂lni szeretn√©d ezt a cikket?',
            confirmText: 'T√∂rl√©s',
            cancelText: 'M√©gse'
        });
        
        if (confirmed) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/admin/blog/${id}/delete`;
            
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = '_csrf';
            csrfInput.value = '<%= csrfToken %>';
            
            form.appendChild(csrfInput);
            document.body.appendChild(form);
            form.submit();
        }
    });
});

// Tag m√°sol√°sa v√°g√≥lapra
function copyTag(element) {
    const tagText = element.textContent.trim();
    
    // V√°g√≥lapra m√°sol√°s
    navigator.clipboard.writeText(tagText).then(() => {
        // Vizu√°lis feedback
        const originalBg = element.className;
        element.className = 'badge badge-info cursor-pointer';
        element.textContent = '‚úì M√°solva!';
        
        setTimeout(() => {
            element.className = originalBg;
            element.textContent = tagText;
        }, 1000);
    }).catch(err => {
        console.error('Nem siker√ºlt m√°solni:', err);
        alert('M√°sol√°s sikertelen. Pr√≥b√°ld √∫jra!');
    });
}
</script>
