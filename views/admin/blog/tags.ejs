<!-- Blog C√≠mk√©k Kezel√©se -->
<div class="page-container">
  <!-- Header -->
  <div class="page-header mb-6">
    <a href="/admin/blog" class="btn btn--secondary">
      ‚Üê Vissza
    </a>
  </div>

  <!-- √úzenetek -->
  <% if (typeof success !== 'undefined' && success) { %>
    <div class="alert alert-success">
      <%= decodeURIComponent(success) %>
    </div>
  <% } %>

  <% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-error">
      <%= decodeURIComponent(error) %>
    </div>
  <% } %>

  <!-- 2-Column Grid Layout -->
  <div class="admin-two-col">
    
    <!-- Left Column: Main Content -->
    <div>

      <!-- √öj c√≠mke l√©trehoz√°sa -->
      <div class="card--data mb-6">
        <h2 class="text-xl font-semibold mb-4">‚ûï √öj c√≠mke l√©trehoz√°sa</h2>
        <form id="createTagForm" class="form--inline">
          <div class="form__group flex-1">
            <label for="tagName" class="form__label">C√≠mke neve</label>
            <input 
              type="text" 
              id="tagName" 
              name="name" 
              class="form__input" 
              placeholder="pl. Koncert, Fesztiv√°l, Zenei esem√©ny"
              required
            >
          </div>
          <button type="submit" class="btn btn--primary mt-6">
            ‚ûï L√©trehoz√°s
          </button>
        </form>
      </div>

      <!-- C√≠mk√©k lista -->
      <div class="card--data">
    <h2 class="text-xl font-semibold mb-4">üè∑Ô∏è √ñsszes c√≠mke</h2>
    
    <% if (tags.length === 0) { %>
      <div class="p-12 text-center text-secondary">
        üè∑Ô∏è <p>M√©g nincsenek c√≠mk√©k</p>
        <p class="text-sm mt-2">Hozd l√©tre az els≈ë c√≠mk√©t a fenti ≈±rlap haszn√°lat√°val.</p>
      </div>
    <% } else { %>
      <div class="table--responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th class="w-10">#</th>
              <th>N√©v</th>
              <th class="w-24 text-center">Bejegyz√©sek</th>
              <th class="w-32 text-center">L√©trehozva</th>
              <th class="w-24">M≈±veletek</th>
            </tr>
          </thead>
          <tbody>
            <% tags.forEach((tag, index) => { %>
              <tr>
                <td data-label="#"><%= index + 1 %></td>
                <td data-label="N√©v">
                  <strong><%= tag.name %></strong>
                </td>
                <td data-label="Bejegyz√©sek" class="text-center">
                  <span class="badge <%= tag.postCount > 0 ? 'badge-info' : 'badge-secondary' %>">
                    <%= tag.postCount %>
                  </span>
                </td>
                <td data-label="L√©trehozva" class="text-center">
                  <span class="text-sm text-muted">
                    <%= new Date(tag.createdAt).toLocaleDateString('hu-HU') %>
                  </span>
                </td>
                <td data-label="M≈±veletek">
                  <div class="actions">
                    <% if (tag.postCount === 0) { %>
                      <button onclick="deleteTag(<%= tag.id %>)" class="btn btn-icon-only btn-error" title="T√∂rl√©s">
                        üóëÔ∏è
                      </button>
                    <% } else { %>
                      <button disabled title="Van hozz√°rendelt bejegyz√©s" class="btn btn-icon-only opacity-30 cursor-not-allowed">
                        üóëÔ∏è
                      </button>
                    <% } %>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

    </div>
    <!-- End of Left Column -->

    <!-- Right Column: Info Boxes -->
    <div>

      <!-- Info K√°rtya -->
      <div class="card--data">
        <h3>üè∑Ô∏è C√≠mk√©k Kezel√©se</h3>
        <div class="card__info-content">
          <p>A c√≠mk√©k seg√≠tenek kategoriz√°lni √©s csoportos√≠tani a blog bejegyz√©seket.</p>
          <p><strong>Fontos tudnival√≥k:</strong></p>
          <ul>
            <li>Egy bejegyz√©shez <strong>t√∂bb c√≠mke</strong> is hozz√°rendelhet≈ë</li>
            <li>A c√≠mke <strong>csak akkor t√∂r√∂lhet≈ë</strong>, ha nincs hozz√° egyetlen bejegyz√©s sem rendelve</li>
            <li>A <strong>"Haszn√°lat"</strong> oszlop mutatja, h√°ny bejegyz√©shez tartozik az adott c√≠mke</li>
            <li>A c√≠mk√©k <strong>automatikusan</strong> URL-bar√°t slug-ot kapnak l√©trehoz√°skor</li>
          </ul>
          <p class="text-sm text-secondary mt-4">
            üí° Tipp: Haszn√°lj √°ltal√°nos, √∫jrafelhaszn√°lhat√≥ c√≠mk√©ket a jobb szervez√©s√©rt!
          </p>
        </div>
      </div>

    </div>
    <!-- End of Right Column -->

  </div>
  <!-- End of Grid -->

</div>

<script>
// √öj c√≠mke l√©trehoz√°sa
document.getElementById('createTagForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const formData = new FormData(e.target);
  const name = formData.get('name').trim();
  
  if (!name) {
    Modal.alert({
      title: 'Hiba',
      message: 'A c√≠mke neve nem lehet √ºres!',
      type: 'error'
    });
    return;
  }
  
  try {
    const response = await fetch('/admin/blog/tags/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': '<%= csrfToken %>'
      },
      body: JSON.stringify({ name })
    });
    
    const data = await response.json();
    
    if (response.ok && data.success) {
      Modal.alert({
        title: 'Siker',
        message: data.message || 'C√≠mke sikeresen l√©trehozva!',
        type: 'success'
      });
      setTimeout(() => location.reload(), 1000);
    } else {
      throw new Error(data.message || 'Hiba t√∂rt√©nt a l√©trehoz√°s sor√°n');
    }
  } catch (error) {
    Modal.alert({
      title: 'Hiba',
      message: '‚ùå ' + error.message,
      type: 'error'
    });
  }
});

// C√≠mke t√∂rl√©se
async function deleteTag(id) {
  const confirmed = await Modal.confirm({
    title: 'C√≠mke t√∂rl√©se',
    message: 'Biztosan t√∂r√∂lni szeretn√©d ezt a c√≠mk√©t?',
    confirmText: 'T√∂rl√©s',
    cancelText: 'M√©gse'
  });
  
  if (confirmed) {
    try {
      const response = await fetch(`/admin/blog/tags/${id}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': '<%= csrfToken %>'
        }
      });
      
      const data = await response.json();
      
      if (response.ok && data.success) {
        Modal.alert({
          title: 'Siker',
          message: data.message || 'C√≠mke sikeresen t√∂r√∂lve!',
          type: 'success'
        });
        setTimeout(() => location.reload(), 1000);
      } else {
        throw new Error(data.message || 'Hiba t√∂rt√©nt a t√∂rl√©s sor√°n');
      }
    } catch (error) {
      Modal.alert({
        title: 'Hiba',
        message: '‚ùå ' + error.message,
        type: 'error'
      });
    }
  }
}
</script>
