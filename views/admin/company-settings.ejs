<!-- Company Settings Page -->

<div class="page-container">
    <div class="admin-two-col">
        
        <!-- Bal oldal: C√©gadatok Form -->
        <div>
            <div class="card--data">
                <h3>
                    üè¢ Alapadatok
                </h3>
                
                <form id="company-form">
                    <!-- Company Name -->
                    <div class="form__group">
                        <label for="company.name">
                            C√©gn√©v <span class="required-field">*</span>
                        </label>
                        <input type="text" 
                               name="company.name" 
                               id="company.name"
                               class="form__control"
                               value="<%= flatSettings['company.name'] || '' %>"
                               placeholder="pl. DMF Art M√©dia Kft."
                               required>
                        <small class="form__hint">Hivatalos c√©gn√©v (l√°bl√©c, kapcsolat)</small>
                    </div>

                    <!-- Phone & Email in 2 columns -->
                    <div class="filter-grid">
                        <div class="form__group">
                            <label for="company.phone">
                                üìû Telefonsz√°m
                            </label>
                            <input type="tel" 
                                   name="company.phone" 
                                   id="company.phone"
                                   class="form__control"
                                   value="<%= flatSettings['company.phone'] || '' %>"
                                   placeholder="+36 70 123 4567">
                            <small class="form__hint">Kapcsolat men√ºben megjelenik</small>
                        </div>

                        <div class="form__group">
                            <label for="company.email">
                                ‚úâÔ∏è Email c√≠m
                            </label>
                            <input type="email" 
                                   name="company.email" 
                                   id="company.email"
                                   class="form__control"
                                   value="<%= flatSettings['company.email'] || '' %>"
                                   placeholder="info@cegnev.hu">
                            <small class="form__hint">Nyilv√°nos kapcsolati email</small>
                        </div>
                    </div>
                </form>
            </div>

            <!-- C√≠m adatok -->
            <div class="card--data card-spacing">
                <h3 class="section-title">
                    üìç C√≠m
                </h3>
                
                <div class="filter-grid">
                    <div class="form__group">
                        <label for="company.address_street">
                            Utca √©s h√°zsz√°m
                        </label>
                        <input type="text" 
                               name="company.address_street" 
                               id="company.address_street"
                               class="form__control"
                               value="<%= flatSettings['company.address_street'] || '' %>"
                               placeholder="P√©lda utca 12."
                               form="company-form">
                    </div>

                    <div class="form__group">
                        <label for="company.address_zip">
                            Ir√°ny√≠t√≥sz√°m
                        </label>
                        <input type="text" 
                               name="company.address_zip" 
                               id="company.address_zip"
                               class="form__control"
                               value="<%= flatSettings['company.address_zip'] || '' %>"
                               placeholder="1234"
                               form="company-form">
                    </div>
                </div>

                <div class="form__group">
                    <label for="company.address_city">
                        V√°ros
                    </label>
                    <input type="text" 
                           name="company.address_city" 
                           id="company.address_city"
                           class="form__control"
                           value="<%= flatSettings['company.address_city'] || '' %>"
                           placeholder="Budapest"
                           form="company-form">
                </div>

                <div class="form__group">
                    <label for="company.address_country">
                        Orsz√°g
                    </label>
                    <input type="text" 
                           name="company.address_country" 
                           id="company.address_country"
                           class="form__control"
                           value="<%= flatSettings['company.address_country'] || '' %>"
                           placeholder="Magyarorsz√°g"
                           form="company-form">
                </div>

                <div class="form__group">
                    <label for="company.address">
                        Teljes c√≠m
                    </label>
                    <input type="text" 
                           name="company.address" 
                           id="company.address"
                           class="form__control"
                           value="<%= flatSettings['company.address'] || '' %>"
                           placeholder="1234 Budapest, P√©lda utca 12."
                           form="company-form">
                    <small class="form__hint">Form√°zott teljes c√≠m (Schema.org SEO)</small>
                </div>
            </div>

            <!-- C√©gjogi adatok -->
            <div class="card--data card-spacing">
                <h3 class="section-title">
                    üìã C√©gjogi adatok
                </h3>
                
                <div class="filter-grid">
                    <div class="form__group">
                        <label for="company.registration_number">
                            C√©gjegyz√©ksz√°m
                        </label>
                        <input type="text" 
                               name="company.registration_number" 
                               id="company.registration_number"
                               class="form__control"
                               value="<%= flatSettings['company.registration_number'] || '' %>"
                               placeholder="01-09-123456"
                               form="company-form">
                    </div>

                    <div class="form__group">
                        <label for="company.tax_number">
                            Ad√≥sz√°m
                        </label>
                        <input type="text" 
                               name="company.tax_number" 
                               id="company.tax_number"
                               class="form__control"
                               value="<%= flatSettings['company.tax_number'] || '' %>"
                               placeholder="12345678-1-23"
                               form="company-form">
                    </div>
                </div>
            </div>

            <!-- Logo -->
            <div class="card--data">
                <h3 class="section-title">
                    üñºÔ∏è C√©glog√≥
                </h3>
                
                <% if (flatSettings['company.logo']) { %>
                <div class="flex justify-center mb-4">
                    <img src="<%= flatSettings['company.logo'] %>" 
                         alt="Company Logo" 
                         class="max-w-xs">
                </div>
                <% } %>
                
                <div>
                    <div>
                        <input type="file" 
                               id="logoFile" 
                               name="companyLogo"
                               class="hidden"
                               accept="image/jpeg,image/png,image/gif,image/svg+xml,image/webp"
                               onchange="updateFileName(this)">
                        <div class="btn__group btn__group--equal">
                            <button type="button" class="btn btn--secondary" onclick="document.getElementById('logoFile').click()">
                                üì§ F√°jl kiv√°laszt√°sa
                            </button>
                            <button type="button" class="btn btn--primary" onclick="uploadLogo()">
                                ‚¨ÜÔ∏è Felt√∂lt√©s
                            </button>
                            <% if (flatSettings['company.logo']) { %>
                            <button type="button" class="btn btn--outline" onclick="deleteLogo()">
                                üóëÔ∏è T√∂rl√©s
                            </button>
                            <% } %>
                        </div>
                    </div>
                    <small id="file-name-display" class="form__hint m-0 hidden"></small>
                    <small class="form__hint m-0">Max. 2MB ‚Ä¢ JPEG, PNG, GIF, SVG, WebP</small>
                </div>
            </div>

            <input type="hidden" 
                   name="company.logo" 
                   id="company.logo"
                   value="<%= flatSettings['company.logo'] || '' %>"
                   form="company-form">

            <!-- Save Button -->
            <div class="btn__group btn__group--equal mb-4">
                <button type="button" class="btn btn--primary" onclick="saveCompany()">
                    üíæ Ment√©s
                </button>
            </div>
        </div>

        <!-- Jobb oldal: Info Panel -->
        <div>
            <!-- SEO Info -->
            <div class="card--data">
                <h3 class="section-title">
                    üîç SEO & Struktur√°lt adat
                </h3>
                
                <div class="info-box-content">
                    <p>
                        <strong>üéØ Schema.org:</strong><br>
                        A c√≠m adatok (v√°ros, ir√°ny√≠t√≥sz√°m, orsz√°g) Schema.org struktur√°lt adatk√©nt ker√ºlnek be√°gyaz√°sra az oldalba.
                    </p>
                    
                    <p>
                        <strong>üîç Google megjelen√©s:</strong><br>
                        Ez√°ltal a Google jobban √©rti a c√©g lok√°ci√≥j√°t √©s k√∂nnyebben megjelen√≠theti a helyi keres√©sekben.
                    </p>
                    
                    <p>
                        <strong>üìä Rich Snippets:</strong><br>
                        A helyes adatok seg√≠tenek abban, hogy a keres√©si tal√°latokban r√©szletesebb inform√°ci√≥k jelenjenek meg.
                    </p>
                </div>
            </div>

            <!-- Haszn√°lati tippek -->
            <div class="card--data card-spacing">
                <h3 class="section-title">
                    üí° Tippek
                </h3>
                
                <div class="info-box-content">
                    <p>
                        <strong>üìû Telefonsz√°m form√°tum:</strong><br>
                        Haszn√°lj nemzetk√∂zi form√°tumot: <code>+36 70 123 4567</code>
                    </p>
                    
                    <p>
                        <strong>üñºÔ∏è Logo:</strong><br>
                        Aj√°nlott m√©ret: 300x100px vagy 4:1 ar√°ny. √Åtl√°tsz√≥ h√°tt√©r (PNG) el≈ëny√∂s.
                    </p>
                    
                    <p>
                        <strong>üìß Email:</strong><br>
                        Ez a c√≠m jelenik meg a l√°bl√©cben √©s a kapcsolat oldalon.
                    </p>
                    
                    <p>
                        <strong>‚úì Ellen≈ërz√©s:</strong><br>
                        Ment√©s ut√°n n√©zd meg a publikus oldalt, hogy minden helyesen jelenik-e meg.
                    </p>
                </div>
            </div>

            <!-- Megjelen√©si helyek -->
            <div class="card--data card-spacing">
                <h3 class="section-title">
                    üó∫Ô∏è Hol jelennek meg?
                </h3>
                
                <div class="schema-display">
                    <div class="schema-item">
                        <strong>üìÑ L√°bl√©c:</strong><br>
                        C√©gn√©v, telefon, email, c√≠m
                    </div>
                    
                    <div class="schema-item">
                        <strong>üìû Kapcsolat oldal:</strong><br>
                        Minden kapcsolati adat
                    </div>
                    
                    <div class="schema-item">
                        <strong>üîç Meta adatok:</strong><br>
                        Schema.org struktur√°lt form√°ban
                    </div>
                    
                    <div class="schema-item">
                        <strong>üñºÔ∏è Logo:</strong><br>
                        Fejl√©c, email sablonok
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const csrfToken = '<%= csrfToken %>';

    // Update file name display
    function updateFileName(input) {
        const fileNameEl = document.getElementById('file-name-display');
        if (input.files && input.files[0]) {
            fileNameEl.textContent = `üìÑ ${input.files[0].name}`;
            fileNameEl.classList.remove('hidden', 'text-secondary');
            fileNameEl.classList.add('text-primary');
        } else {
            fileNameEl.classList.add('hidden');
        }
    }

    // Upload company logo
    async function uploadLogo() {
        const fileInput = document.getElementById('logoFile');
        
        if (!fileInput.files || !fileInput.files[0]) {
            showAlert('warning', '‚ö†Ô∏è K√©rlek v√°lassz ki egy k√©pf√°jlt!');
            return;
        }
        
        const formData = new FormData();
        formData.append('companyLogo', fileInput.files[0]);
        
        showAlert('info', '‚è≥ Felt√∂lt√©s folyamatban...');
        
        try {
            const response = await fetch('/admin/company/upload-logo', {
                method: 'POST',
                headers: {
                    'X-CSRF-Token': csrfToken
                },
                body: formData
            });
            
            const data = await response.json();
            
            if (data.success) {
                showAlert('success', `‚úÖ ${data.message || 'C√©glog√≥ sikeresen felt√∂ltve!'}`);
                document.getElementById('company.logo').value = data.logoPath;
                setTimeout(() => window.location.reload(), 1500);
            } else {
                showAlert('error', `‚ùå ${data.message || 'Hiba t√∂rt√©nt a felt√∂lt√©s sor√°n'}`);
            }
        } catch (error) {
            showAlert('error', `‚ùå H√°l√≥zati hiba: ${error.message}`);
        }
    }

    // Delete company logo
    async function deleteLogo() {
        const confirmed = await Modal.confirm({
            title: 'T√∂rl√©s meger≈ës√≠t√©se',
            message: 'Biztosan t√∂r√∂lni szeretn√©d a c√©glog√≥t? Ez a m≈±velet nem vonhat√≥ vissza.',
            confirmText: 'T√∂rl√©s',
            cancelText: 'M√©gse'
        });
        
        if (!confirmed) {
            return;
        }
        
        showAlert('info', '‚è≥ T√∂rl√©s folyamatban...');
        
        try {
            const response = await fetch('/admin/company/delete-logo', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': csrfToken
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                showAlert('success', `‚úÖ ${data.message || 'C√©glog√≥ sikeresen t√∂r√∂lve!'}`);
                document.getElementById('company.logo').value = '';
                setTimeout(() => window.location.reload(), 1500);
            } else {
                showAlert('error', `‚ùå ${data.message || 'Hiba t√∂rt√©nt a t√∂rl√©s sor√°n'}`);
            }
        } catch (error) {
            showAlert('error', `‚ùå H√°l√≥zati hiba: ${error.message}`);
        }
    }

    // Save company settings
    async function saveCompany() {
        const form = document.getElementById('company-form');
        
        // Collect ALL form fields (including hidden ones and those with form attribute)
        const settingsObj = {};
        const inputs = document.querySelectorAll('input[form="company-form"], #company-form input, #company-form select, #company-form textarea');
        inputs.forEach(input => {
            if (input.name && input.type !== 'file') {
                settingsObj[input.name] = input.value || '';
            }
        });
        
        try {
            const response = await fetch('/admin/company/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': csrfToken
                },
                body: JSON.stringify({ settings: settingsObj })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showAlert('success', `‚úÖ ${data.message || 'C√©gadatok sikeresen mentve!'}`);
            } else {
                showAlert('error', `‚ùå ${data.message || 'Hiba t√∂rt√©nt a ment√©s sor√°n'}`);
            }
        } catch (error) {
            showAlert('error', `‚ùå H√°l√≥zati hiba: ${error.message}`);
        }
    }

    // ‚úÖ DESIGN SYSTEM: Uses global showAlert() from admin-alerts.js
</script>
