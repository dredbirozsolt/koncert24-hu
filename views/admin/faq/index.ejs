<!-- FAQ Management Page -->


<div class="page-container">
    <% if (success) { %>
        <div class="alert alert-success">
            <%= decodeURIComponent(success) %>
        </div>
    <% } %>

    <% if (error) { %>
        <div class="alert alert-error">
            <%= decodeURIComponent(error) %>
        </div>
    <% } %>

    <!-- 2 oszlopos grid -->
    <div class="admin-two-col">
        <!-- BAL OSZLOP: Kateg√≥ri√°k √©s K√©rd√©sek -->
        <div>
            <!-- Action Buttons -->
            <div class="btn__group btn__group--equal mb-4">
                <a href="/admin/faq/categories/new" class="btn btn--primary">
                    üìÅ √öj Kateg√≥ria
                </a>
                <a href="/admin/faq/items/new" class="btn btn--primary">
                    ‚ûï √öj K√©rd√©s
                </a>
            </div>

    <% if (!categories || categories.length === 0) { %>
        <div class="empty-state">
            <div class="empty-state-icon">üìù</div>
            <h2 class="empty-state-title">M√©g nincs GYIK kateg√≥ria</h2>
            <p class="empty-state-text">Kezdd el az els≈ë kateg√≥ria l√©trehoz√°s√°val!</p>
            <a href="/admin/faq/categories/new" class="btn btn--primary btn--lg">
                ‚ûï Els≈ë Kateg√≥ria L√©trehoz√°sa
            </a>
        </div>
    <% } else { %>
        <!-- Categories with Tables -->
        <% categories.forEach((category) => { %>
            <div class="card--data">
                <!-- Category Header -->
                <div class="py-4 border-b flex items-center">
                    <div class="flex items-center gap-3 flex-1">
                        <span class="text-3xl"><%= category.icon %></span>
                        <div>
                            <h2 class="m-0 text-xl"><%= category.name %></h2>
                            <% if (category.description) { %>
                                <small class="text-secondary"><%= category.description %></small>
                            <% } %>
                        </div>
                    </div>
                    <div class="flex items-center gap-6">
                        <span class="badge <%= category.isActive ? 'badge-success' : 'badge-error' %>">
                            <%= category.isActive ? 'Akt√≠v' : 'Inakt√≠v' %>
                        </span>
                        <span class="text-secondary">Sorrend: <%= category.displayOrder %></span>
                        <span class="text-secondary"><%= category.items.length %> k√©rd√©s</span>
                        <div class="flex gap-2">
                            <a href="/admin/faq/categories/<%= category.id %>/edit" 
                               class="btn btn--secondary btn-icon-only"
                               title="Szerkeszt√©s">
                                ‚úèÔ∏è
                            </a>
                            <button class="btn btn-error btn-icon-only"
                                    onclick="deleteFaqCategory('<%= category.id %>', '<%= category.name %>', <%= category.items.length %>)"
                                    title="T√∂rl√©s">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>

                <!-- FAQ Items Table -->
                <% if (category.items && category.items.length > 0) { %>
                    <div class="table--responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>K√©rd√©s</th>
                                    <th class="text-center">St√°tusz</th>
                                    <th class="text-center">Sorrend</th>
                                    <th class="text-center">Megtekint√©s</th>
                                    <th>M≈±veletek</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% category.items.forEach((item) => { %>
                                    <tr>
                                        <td data-label="K√©rd√©s">
                                            <%= item.question %>
                                        </td>
                                        <td data-label="St√°tusz" class="text-center">
                                            <span class="badge <%= item.isActive ? 'badge-success' : 'badge-error' %>">
                                                <%= item.isActive ? 'Akt√≠v' : 'Inakt√≠v' %>
                                            </span>
                                        </td>
                                        <td data-label="Sorrend" class="text-center"><%= item.displayOrder %></td>
                                        <td data-label="Megtekint√©s" class="text-center">
                                            <%= item.viewCount %>
                                        </td>
                                        <td data-label="M≈±veletek">
                                            <div class="actions">
                                                <a href="/admin/faq/items/<%= item.id %>/edit" 
                                                   class="btn btn-icon-only btn--secondary" 
                                                   
                                                   title="Szerkeszt√©s">
                                                    ‚úèÔ∏è
                                                </a>
                                                <button class="btn btn-icon-only btn-error"
                                                        onclick="deleteFaqItem('<%= item.id %>', '<%= item.question.replace(/'/g, "\\'") %>')"
                                                        title="T√∂rl√©s">
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                <% } else { %>
                    <div class="p-8 text-center text-secondary">
                        <p>M√©g nincs k√©rd√©s ebben a kateg√≥ri√°ban.</p>
                        <a href="/admin/faq/items/new" class="btn btn--primary">
                            ‚ûï √öj K√©rd√©s Hozz√°ad√°sa
                        </a>
                    </div>
                <% } %>
            </div>
        <% }); %>
    <% } %>
        </div>
        <!-- /.bal oszlop -->

        <!-- JOBB OSZLOP: Info Boxok -->
        <div>
            
            <!-- GYIK Strukt√∫ra -->
            <div class="card--data">
                <h3 class="section-title">
                    üó∫Ô∏è GYIK Strukt√∫ra
                </h3>
                <div class="card__info-content">
                    <p class="mb-3">A GYIK (Gyakran Ism√©telt K√©rd√©sek) k√©t szintb≈ël √°ll:</p>
                    
                    <p><strong>1Ô∏è‚É£ Kateg√≥ri√°k:</strong></p>
                    <p class="text-sm my-2">
                        T√©m√°k szerinti csoportos√≠t√°s (pl. Jegyek, Sz√°ll√°s, Parkol√°s)
                    </p>
                    
                    <p class="mt-3"><strong>2Ô∏è‚É£ K√©rd√©sek:</strong></p>
                    <p class="text-sm my-2">
                        Az egyes k√©rd√©sek √©s v√°laszok a kateg√≥ri√°kon bel√ºl
                    </p>
                    
                    <p class="text-sm text-muted mt-3">
                        üí° Tipp: El≈ësz√∂r hozz l√©tre kateg√≥ri√°kat, majd adj hozz√° k√©rd√©seket!
                    </p>
                </div>
            </div>

            <!-- Kateg√≥ria Kezel√©s -->
            <div class="card--data">
                <h3 class="section-title">
                    üìÅ Kateg√≥ria Kezel√©s
                </h3>
                <div class="card__info-content">
                    <p><strong>Kateg√≥ria tulajdons√°gok:</strong></p>
                    <ul class="my-2 pl-5 text-sm">
                        <li class="mb-2"><strong>N√©v:</strong> A kateg√≥ria megnevez√©se</li>
                        <li class="mb-2"><strong>Ikon:</strong> Emoji vagy ikon a vizu√°lis megk√ºl√∂nb√∂ztet√©shez</li>
                        <li class="mb-2"><strong>Le√≠r√°s:</strong> Opcion√°lis r√∂vid ismertet≈ë</li>
                        <li class="mb-2"><strong>St√°tusz:</strong> Akt√≠v vagy Inakt√≠v</li>
                        <li><strong>Sorrend:</strong> A megjelen√≠t√©si sorrend sz√°ma</li>
                    </ul>
                    
                    <p class="text-sm text-muted mt-3">
                        ‚ö†Ô∏è Kateg√≥ria t√∂rl√©sekor az √∂sszes benne l√©v≈ë k√©rd√©s is t√∂rl≈ëdik!
                    </p>
                </div>
            </div>

            <!-- K√©rd√©s Kezel√©s -->
            <div class="card--data">
                <h3 class="section-title">
                    ‚ùì K√©rd√©s Kezel√©s
                </h3>
                <div class="card__info-content">
                    <p><strong>K√©rd√©s tulajdons√°gok:</strong></p>
                    <ul class="my-2 pl-5 text-sm">
                        <li class="mb-2"><strong>K√©rd√©s:</strong> A felhaszn√°l√≥ k√©rd√©se (r√∂vid, t√∂m√∂r)</li>
                        <li class="mb-2"><strong>V√°lasz:</strong> R√©szletes v√°lasz, t√°mogatja a HTML-t</li>
                        <li class="mb-2"><strong>Kateg√≥ria:</strong> Melyik kateg√≥ri√°hoz tartozik</li>
                        <li class="mb-2"><strong>St√°tusz:</strong> Akt√≠v vagy Inakt√≠v</li>
                        <li><strong>Sorrend:</strong> Sorrend a kateg√≥ri√°n bel√ºl</li>
                    </ul>
                </div>
            </div>

            <!-- Sorrend Kezel√©se -->
            <div class="card--data">
                <h3 class="section-title">
                    ‚áÖ Sorrend Kezel√©se
                </h3>
                <div class="card__info-content">
                    <p>A sorrend sz√°mok hat√°rozz√°k meg a megjelen√©si sorrendet a weboldalon.</p>
                    
                    <p class="mt-3"><strong>Kateg√≥ri√°k sorrendje:</strong></p>
                    <p class="text-sm my-2">
                        Alacsonyabb sz√°m = el≈ër√©bb jelenik meg a list√°ban
                    </p>
                    
                    <p class="mt-3"><strong>K√©rd√©sek sorrendje:</strong></p>
                    <p class="text-sm my-2">
                        A kateg√≥ri√°n bel√ºli sorrend (alacsonyabb = el≈ër√©bb)
                    </p>
                    
                    <p class="text-sm text-muted mt-3">
                        ‚ÑπÔ∏è Alap√©rtelmezett √©rt√©k: 0. Azonos sorrend eset√©n ABC sorrend.
                    </p>
                </div>
            </div>

            <!-- St√°tusz Kezel√©s -->
            <div class="card--data">
                <h3 class="section-title">
                    üîõ Akt√≠v/Inakt√≠v St√°tusz
                </h3>
                <div class="card__info-content">
                    <div class="mb-3">
                        <strong class="text-success">‚úÖ Akt√≠v:</strong>
                        <p class="my-1 text-sm">Megjelenik a weboldalon a l√°togat√≥k sz√°m√°ra</p>
                    </div>
                    <div>
                        <strong class="text-error">‚ùå Inakt√≠v:</strong>
                        <p class="my-1 text-sm">Nem jelenik meg, de az adatok megmaradnak</p>
                    </div>
                    
                    <p class="mt-3"><strong>Haszn√°lati javaslatok:</strong></p>
                    <ul class="my-2 pl-5 text-sm">
                        <li class="mb-2">Inakt√≠v kateg√≥ria: az √∂sszes benne l√©v≈ë k√©rd√©s is elrejthet≈ë</li>
                        <li>Inakt√≠v k√©rd√©s: ideiglenes elrejt√©s friss√≠t√©s vagy √°tdolgoz√°s el≈ëtt</li>
                    </ul>
                </div>
            </div>

            <!-- Megtekint√©s Statisztika -->
            <div class="card--data">
                <h3 class="section-title">
                    üìà Megtekint√©s Statisztika
                </h3>
                <div class="card__info-content">
                    <p>Minden k√©rd√©sn√©l nyomon k√∂vetheted a megtekint√©sek sz√°m√°t.</p>
                    
                    <p class="mt-3"><strong>Mit mutat?</strong></p>
                    <p class="text-sm my-2">
                        H√°nyszor nyitott√°k meg az adott k√©rd√©st a weboldalon
                    </p>
                    
                    <p class="mt-3"><strong>Mire haszn√°lhat√≥?</strong></p>
                    <ul class="my-2 pl-5 text-sm">
                        <li class="mb-2">N√©pszer≈± t√©m√°k azonos√≠t√°sa</li>
                        <li class="mb-2">Tartalmi priorit√°sok meghat√°roz√°sa</li>
                        <li>Ritk√°n n√©zett k√©rd√©sek √°tdolgoz√°sa vagy t√∂rl√©se</li>
                    </ul>
                    
                    <p class="text-sm text-muted mt-3">
                        üí° Tipp: A legt√∂bbet n√©zett k√©rd√©seket tedd el≈ër√©bb a sorrendben!
                    </p>
                </div>
            </div>
        </div>
        <!-- /.jobb oszlop -->
    </div>
    <!-- /.faq-grid -->
</div>
<!-- /.page-container -->

<script>
// Delete FAQ Category
async function deleteFaqCategory(categoryId, categoryName, itemCount) {
    const message = itemCount > 0 
        ? `Biztosan t√∂r√∂lni szeretn√©d a "${categoryName}" kateg√≥ri√°t? Ez ${itemCount} k√©rd√©st is t√∂r√∂l!`
        : `Biztosan t√∂r√∂lni szeretn√©d a "${categoryName}" kateg√≥ri√°t?`;
    
    const confirmed = await Modal.confirm({
        title: 'Kateg√≥ria t√∂rl√©se',
        message: message,
        confirmText: 'T√∂rl√©s',
        cancelText: 'M√©gse'
    });
    
    if (confirmed) {
        const csrfToken = document.querySelector('input[name="_csrf"]').value;
        
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/faq/categories/${categoryId}/delete`;
        
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = '_csrf';
        csrfInput.value = csrfToken;
        
        form.appendChild(csrfInput);
        document.body.appendChild(form);
        form.submit();
    }
}

// Delete FAQ Item
async function deleteFaqItem(itemId, question) {
    const confirmed = await Modal.confirm({
        title: 'K√©rd√©s t√∂rl√©se',
        message: `Biztosan t√∂r√∂lni szeretn√©d ezt a k√©rd√©st?\n\n"${question}"`,
        confirmText: 'T√∂rl√©s',
        cancelText: 'M√©gse'
    });
    
    if (confirmed) {
        const csrfToken = document.querySelector('input[name="_csrf"]').value;
        
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/faq/items/${itemId}/delete`;
        
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = '_csrf';
        csrfInput.value = csrfToken;
        
        form.appendChild(csrfInput);
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
