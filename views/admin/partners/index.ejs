<!-- Admin Partners Management -->


<div class="page-container">
    <!-- 2 oszlopos grid -->
    <div class="admin-two-col">
        <!-- BAL OSZLOP: Statisztik√°k, Sz≈±r≈ëk, T√°bl√°zat -->
        <div>
            <!-- Statistics -->
            <div class="card--data">
                <h3>üìä Statisztik√°k</h3>
                <div class="stats-grid">
                    <div class="card--stat card--stat--primary">
                        <h3>üìä √ñsszes Partner</h3>
                        <div class="stat-value"><%= partners.length %></div>
                    </div>
                    <div class="card--stat card--stat--success">
                        <h3>‚úÖ Akt√≠v</h3>
                        <div class="stat-value"><%= partners.filter(p => p.status === 'active').length %></div>
                    </div>
                    <div class="card--stat card--stat--warning">
                        <h3>‚è≥ F√ºgg≈ëben</h3>
                        <div class="stat-value"><%= partners.filter(p => p.status === 'pending').length %></div>
                    </div>
                    <div class="card--stat card--stat--primary">
                        <h3>üîó Backlinkkel</h3>
                        <div class="stat-value"><%= partners.filter(p => p.backlinkUrl && p.isVerified).length %></div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="card--filter mb-4">
        <form method="GET" action="/admin/partners">
            <div class="filter-grid-inline grid-cols-3">
                <div class="form__group mb-0">
                    <label>Keres√©s</label>
                    <input type="text" name="search" class="form__control"
                           placeholder="N√©v vagy weboldal..."
                           value="<%= filters.search || '' %>">
                </div>
                <div class="form__group mb-0">
                    <label>St√°tusz</label>
                    <select name="status" class="form__select">
                        <option value="">√ñsszes</option>
                        <option value="active" <%= filters.status === 'active' ? 'selected' : '' %>>Akt√≠v</option>
                        <option value="inactive" <%= filters.status === 'inactive' ? 'selected' : '' %>>Inakt√≠v</option>
                        <option value="pending" <%= filters.status === 'pending' ? 'selected' : '' %>>F√ºgg≈ëben</option>
                    </select>
                </div>
                <div class="form__group mb-0">
                    <label>Kateg√≥ria</label>
                    <select name="categoryId" class="form__select">
                        <option value="">√ñsszes</option>
                        <% if (categories && categories.length > 0) { %>
                            <% categories.forEach(cat => { %>
                                <option value="<%= cat.id %>" <%= filters.categoryId == cat.id ? 'selected' : '' %>>
                                    <% if (cat.icon) { %><i class="<%= cat.icon %>"></i> <% } %>
                                    <%= cat.name %>
                                </option>
                            <% }); %>
                        <% } %>
                    </select>
                </div>
            </div>
            <div class="btn__group btn__group--equal mt-3">
                <button type="submit" class="btn btn--primary">
                    üîç Sz≈±r√©s
                </button>
            </div>
        </form>
    </div>

            <!-- Action Buttons -->
            <div class="btn__group btn__group--equal mb-4">
        <a href="/admin/partners/categories" class="btn btn--secondary">
            ‚öôÔ∏è Kateg√≥ri√°k kezel√©se
        </a>
        <a href="/admin/partners/new" class="btn btn--primary">
            ‚ûï √öj Partner
        </a>
    </div>

            <!-- Partners Table -->
            <div class="card--data">
        <% if (partners.length === 0) { %>
            <div class="empty-state">
                ü§ù <h3 class="my-4 text-primary">M√©g nincsenek partnerek</h3>
                <p>Kezdj el partnereket hozz√°adni!</p>
                <a href="/admin/partners/new" class="btn btn--primary mt-2">
                    ‚ûï Els≈ë Partner Hozz√°ad√°sa
                </a>
            </div>
        <% } else { %>
            <div class="table--responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Logo</th>
                            <th>Partner</th>
                            <th>Weboldal</th>
                            <th>St√°tusz</th>
                            <th>M≈±veletek</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% partners.forEach(partner => { %>
                            <tr>
                                <td data-label="Logo">
                                    <% if (partner.logo) { %>
                                        <img src="<%= partner.logo %>" 
                                             alt="<%= partner.name %> log√≥" 
                                             title="<%= partner.name %>" 
                                             width="100" 
                                             height="50" 
                                             class="w-15 h-15 object-contain rounded-lg border-2 p-1">
                                    <% } else { %>
                                        üñºÔ∏è <% } %>
                                </td>
                                <td data-label="Partner">
                                    <strong><%= partner.name %></strong>
                                    <% if (partner.contactName) { %>
                                        <br><small class="text-secondary"><%= partner.contactName %></small>
                                    <% } %>
                                </td>
                                <td data-label="Weboldal">
                                    <a href="<%= partner.websiteUrl %>" target="_blank">
                                        <%= partner.websiteUrl.replace(/^https?:\/\/(www\.)?/, '') %>
                                    </a>
                                </td>
                                <td data-label="St√°tusz">
                                    <% if (partner.status === 'active') { %>
                                        <span class="badge badge-success">
                                            Akt√≠v
                                        </span>
                                    <% } else { %>
                                        <span class="badge badge-error">
                                            Inakt√≠v
                                        </span>
                                    <% } %>
                                </td>
                                <td data-label="M≈±veletek">
                                    <div class="actions">
                                        <a href="/admin/partners/<%= partner.id %>/edit" class="btn btn-icon-only btn--secondary" title="Szerkeszt√©s">
                                            ‚úèÔ∏è
                                        </a>
                                        <button class="btn btn-icon-only btn-error delete-partner" 
                                                data-id="<%= partner.id %>" 
                                                data-name="<%= partner.name %>"
                                                title="T√∂rl√©s">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        <% } %>
    </div>
        </div>
        <!-- /.bal oszlop -->

        <!-- JOBB OSZLOP: Info Boxok -->
        <div>
            
            <!-- Partner St√°tuszok -->
            <div class="card--data">
                <h3 class="section-title">
                    üì∂ St√°tusz T√≠pusok
                </h3>
                <div class="card__info-content">
                    <div class="mb-3">
                        <strong class="text-success">‚úÖ Akt√≠v:</strong>
                        <p class="my-1 text-sm">A partner megjelenik a weboldal partner szekci√≥j√°ban</p>
                    </div>
                    <div class="mb-3">
                        <strong class="text-error">‚ùå Inakt√≠v:</strong>
                        <p class="my-1 text-sm">A partner nem jelenik meg, de az adatai megmaradnak</p>
                    </div>
                    <div>
                        <strong class="text-warning">üïê F√ºgg≈ëben:</strong>
                        <p class="my-1 text-sm">Folyamatban l√©v≈ë partner regisztr√°ci√≥, m√©g nem akt√≠v</p>
                    </div>
                </div>
            </div>

            <!-- Backlink Ellen≈ërz√©s -->
            <div class="card--data">
                <h3 class="section-title">
                    üîó Backlink Ellen≈ërz√©s
                </h3>
                <div class="card__info-content">
                    <p class="mb-3">A backlink (visszahivatkoz√°s) ellen≈ërz√©se automatikusan t√∂rt√©nik.</p>
                    
                    <p><strong>Hogyan m≈±k√∂dik?</strong></p>
                    <ol class="my-2 pl-5 text-sm">
                        <li class="mb-2">Add meg a partner backlink URL-j√©t</li>
                        <li class="mb-2">Kattints az ellen≈ërz√©s gombra (üîç)</li>
                        <li class="mb-2">A rendszer ellen≈ërzi, hogy a partner oldal√°n szerepel-e a link√ºnk</li>
                        <li>Ha megtal√°lhat√≥, a st√°tusz "‚úÖ Ellen≈ërizve" lesz</li>
                    </ol>
                    
                    <p class="text-sm text-muted mt-3">
                        ‚ÑπÔ∏è Az √∫jraellen≈ërz√©s gombbal (üîÑ) friss√≠theted a st√°tuszt.
                    </p>
                </div>
            </div>

            <!-- Kateg√≥ri√°k -->
            <div class="card--data">
                <h3 class="section-title">
                    üìÅ Kateg√≥ri√°k
                </h3>
                <div class="card__info-content">
                    <p>A partner kateg√≥ri√°k seg√≠tenek szervezni √©s csoportos√≠tani a partnereket.</p>
                    
                    <p class="mt-3"><strong>El≈ëny√∂k:</strong></p>
                    <ul class="my-2 pl-5 text-sm">
                        <li class="mb-2">√Åttekinthet≈ëbb partner lista</li>
                        <li class="mb-2">K√∂nnyebb sz≈±r√©s √©s keres√©s</li>
                        <li class="mb-2">Ikonok √©s sz√≠nek vizu√°lis megk√ºl√∂nb√∂ztet√©sre</li>
                    </ul>
                </div>
            </div>

            <!-- Logo √©s K√©pek -->
            <div class="card--data">
                <h3 class="section-title">
                    üñºÔ∏è Logo K√∂vetelm√©nyek
                </h3>
                <div class="card__info-content">
                    <p><strong>Aj√°nlott logo specifik√°ci√≥k:</strong></p>
                    <ul class="my-2 pl-5 text-sm">
                        <li class="mb-2">M√©ret: 400x400px vagy 200x100px</li>
                        <li class="mb-2">Form√°tum: PNG (√°tl√°tsz√≥ h√°tt√©rrel) vagy SVG</li>
                        <li class="mb-2">F√°jlm√©ret: max 200 KB</li>
                        <li class="mb-2">H√°tt√©r: √°tl√°tsz√≥ vagy feh√©r</li>
                    </ul>
                    
                    <p class="mt-3"><strong>Tippek:</strong></p>
                    <p class="text-sm my-2">
                        ‚Ä¢ Haszn√°lj vektoros (SVG) log√≥t ha lehets√©ges<br>
                        ‚Ä¢ A logo legyen tiszta, j√≥l olvashat√≥<br>
                        ‚Ä¢ Ker√ºld a t√∫l kis vagy t√∫l nagy log√≥kat
                    </p>
                </div>
            </div>

            <!-- Sorrend √©s Megjelen√©s -->
            <div class="card--data">
                <h3 class="section-title">
                    ‚áÖ Sorrend Kezel√©se
                </h3>
                <div class="card__info-content">
                    <p>A partnerek megjelen√©si sorrendje a "Sorrend" mez≈ë alapj√°n t√∂rt√©nik.</p>
                    
                    <p class="mt-3"><strong>Hogyan m≈±k√∂dik?</strong></p>
                    <ul class="my-2 pl-5 text-sm">
                        <li class="mb-2">Alacsonyabb sz√°m = el≈ër√©bb jelenik meg</li>
                        <li class="mb-2">Alap√©rtelmezett √©rt√©k: 0</li>
                        <li class="mb-2">Azonos sorrend eset√©n ABC sorrend szerint</li>
                    </ul>
                    
                    <p class="text-sm text-muted mt-3">
                        üí° Tipp: A legfontosabb partnereket add meg 1, 2, 3... sorrendel!
                    </p>
                </div>
            </div>

            <!-- Partner Adatok -->
            <div class="card--data">
                <h3 class="section-title">
                    üíæ Partner Inform√°ci√≥k
                </h3>
                <div class="card__info-content">
                    <p><strong>K√∂telez≈ë mez≈ëk:</strong></p>
                    <ul class="my-2 pl-5 text-sm">
                        <li class="mb-2"><strong>N√©v:</strong> A partner c√©g neve</li>
                        <li class="mb-2"><strong>Weboldal URL:</strong> A partner honlapja</li>
                        <li class="mb-2"><strong>St√°tusz:</strong> Akt√≠v/Inakt√≠v/F√ºgg≈ëben</li>
                    </ul>
                    
                    <p class="mt-3"><strong>Opcion√°lis mez≈ëk:</strong></p>
                    <ul class="my-2 pl-5 text-sm">
                        <li class="mb-2">Logo, le√≠r√°s, kapcsolattart√≥</li>
                        <li class="mb-2">Backlink URL, email, telefon</li>
                        <li>Kateg√≥ria, sorrend</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- /.jobb oszlop -->
    </div>
    <!-- /.admin-two-col -->
</div>
<!-- /.page-container -->

<script src="/js/design-system/modal.js"></script>
<script>
let deleteModal = null;

document.querySelectorAll('.delete-partner').forEach(btn => {
    btn.addEventListener('click', function() {
        const partnerName = this.dataset.name;
        const partnerId = this.dataset.id;
        
        const content = `
            <p>Biztosan t√∂r√∂lni szeretn√©d a(z) <strong>${partnerName}</strong> partnert?</p>
        `;
        
        const footer = `
            <button type="button" class="btn btn--secondary modal-cancel">M√©gse</button>
            <form method="POST" action="/admin/partners/${partnerId}/delete" class="inline m-0">
                <button type="submit" class="btn btn-error">T√∂rl√©s</button>
            </form>
        `;
        
        deleteModal = Modal.create({
            title: 'Partner T√∂rl√©se',
            content: content,
            footer: footer,
            size: 'sm'
        });
        
        deleteModal.open();
        
        // Bind cancel button
        setTimeout(() => {
            const cancelBtn = deleteModal.modalElement.querySelector('.modal-cancel');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => deleteModal.close());
            }
        }, 0);
    });
});

// Backlink ellen≈ërz√©s
document.querySelectorAll('.verify-backlink').forEach(btn => {
    btn.addEventListener('click', async function() {
        const partnerId = this.dataset.id;
        const originalText = this.innerHTML;
        
        // Bet√∂lt√©s jelz√©se
        this.innerHTML = '‚è≥';
        this.disabled = true;
        
        try {
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
            const response = await fetch(`/admin/partners/${partnerId}/verify-backlink`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': csrfToken
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                if (result.isVerified) {
                    Modal.alert({
                        title: 'Siker',
                        message: 'Backlink sikeresen ellen≈ërizve! A link megtal√°lhat√≥ a partner oldal√°n.',
                        type: 'success'
                    });
                } else {
                    Modal.alert({
                        title: 'Hiba',
                        message: 'A backlink nem tal√°lhat√≥ a partner oldal√°n.',
                        type: 'error'
                    });
                }
                // Oldal friss√≠t√©se az √∫j st√°tusz megjelen√≠t√©s√©hez
                window.location.reload();
            } else {
                Modal.alert({
                    title: 'Hiba',
                    message: 'Hiba: ' + result.error,
                    type: 'error'
                });
                this.innerHTML = originalText;
                this.disabled = false;
            }
        } catch (error) {
            console.error('Backlink ellen≈ërz√©si hiba:', error);
            Modal.alert({
                title: 'Hiba',
                message: 'Hiba t√∂rt√©nt az ellen≈ërz√©s sor√°n.',
                type: 'error'
            });
            this.innerHTML = originalText;
            this.disabled = false;
        }
    });
});
</script>
