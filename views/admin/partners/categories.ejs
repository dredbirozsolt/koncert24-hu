<!-- Partner KategÃ³riÃ¡k Lista -->
<div class="page-container">
  <!-- KÃ©t oszlopos layout -->
  <div class="admin-two-col">
    <!-- BAL OSZLOP: StatisztikÃ¡k Ã©s TÃ¡blÃ¡zat -->
    <div>
      <!-- StatisztikÃ¡k -->
      <div class="card--data">
        <h3>ğŸ“Š StatisztikÃ¡k</h3>
        <div class="stats-grid">
          <div class="card--stat card--stat--primary">
            <h3>ğŸ“ Ã–sszes KategÃ³ria</h3>
            <div class="stat-value"><%= stats.totalCategories %></div>
          </div>
          <div class="card--stat card--stat--success">
            <h3>âœ… AktÃ­v</h3>
            <div class="stat-value"><%= stats.activeCategories %></div>
          </div>
          <div class="card--stat card--stat--warning">
            <h3>â¸ï¸ InaktÃ­v</h3>
            <div class="stat-value"><%= stats.inactiveCategories %></div>
          </div>
          <div class="card--stat card--stat--info">
            <h3>ğŸ‘¥ Ã–sszes Partner</h3>
            <div class="stat-value"><%= stats.totalPartners %></div>
          </div>
        </div>
      </div>

      <!-- Ãšj kategÃ³ria gomb -->
      <div class="btn__group btn__group--equal mb-4">
        <a href="/admin/partners" class="btn btn--secondary">
          â† Vissza
        </a>
        <a href="/admin/partners/categories/new" class="btn btn--primary">
          â• Ãšj kategÃ³ria
        </a>
      </div>

      <!-- KategÃ³riÃ¡k tÃ¡bla -->
      <div class="card--data">
        <div class="table--responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th class="w-16">#</th>
                <th>NÃ©v</th>
                <th class="w-32 text-center">Partnerek</th>
                <th class="w-32 text-center">Sorrend</th>
                <th class="w-32 text-center">AktÃ­v</th>
                <th class="w-48 text-center">MÅ±veletek</th>
              </tr>
            </thead>
            <tbody>
        <% if (categories && categories.length > 0) { %>
          <% categories.forEach((category, index) => { %>
            <tr>
              <td><%= index + 1 %></td>
              <td>
                <strong><%= category.name %></strong>
              </td>
              <td class="text-center">
                <span class="badge badge-info">
                  <%= category.activeCount || 0 %> db
                </span>
              </td>
              <td class="text-center"><%= category.displayOrder %></td>
              <td class="text-center">
                <% if (category.isActive) { %>
                  <span class="badge badge-success">
                    âœ“ Igen
                  </span>
                <% } else { %>
                  <span class="badge badge-error">
                    âœ–ï¸ Nem
                  </span>
                <% } %>
              </td>
              <td class="text-center">
                <div class="actions justify-center">
                  <a href="/admin/partners/categories/<%= category.id %>/edit" 
                     class="btn btn-icon-only btn--secondary" 
                     title="SzerkesztÃ©s">
                    âœï¸
                  </a>
                  <% if (category.partnerCount === 0) { %>
                    <button 
                      onclick="deleteCategory(<%= category.id %>, '<%= category.name %>', <%= category.partnerCount %>)" 
                      class="btn btn-icon-only btn-error"
                      title="TÃ¶rlÃ©s">
                      ğŸ—‘ï¸
                    </button>
                  <% } else { %>
                    <button 
                      disabled
                      class="btn btn-icon-only opacity-30 cursor-not-allowed"
                      title="Nem tÃ¶rÃ¶lhetÅ‘ (van hozzÃ¡rendelt partner)">
                      ğŸ—‘ï¸
                    </button>
                  <% } %>
                </div>
              </td>
            </tr>
          <% }); %>
        <% } else { %>
          <tr>
            <td colspan="6" class="text-center p-8 text-secondary">
              ğŸ“¥ MÃ©g nincsenek kategÃ³riÃ¡k. Klikk az "Ãšj kategÃ³ria" gombra a lÃ©trehozÃ¡shoz!
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
    </div>
  </div>
  <!-- /.card--data (tÃ¡blÃ¡zat) -->
</div>
<!-- /.bal oszlop -->

<!-- JOBB OSZLOP: Info -->
<div>
  <!-- Info kÃ¡rtya -->
  <div class="card--data">
    <h3>ğŸ’¡ TudnivalÃ³k</h3>
    <div class="text-sm space-y-2">
      <p><strong>Sorrend:</strong> A kategÃ³riÃ¡k megjelenÃ­tÃ©si sorrendje a kisebb szÃ¡m = elÅ‘rÃ©bb elv szerint.</p>
      <p><strong>Slug:</strong> Ha Ã¼resen hagyod, automatikusan generÃ¡lÃ³dik a nÃ©vbÅ‘l.</p>
      <p><strong>TÃ¶rlÃ©s:</strong> Csak Ã¼res kategÃ³riÃ¡k tÃ¶rÃ¶lhetÅ‘k (0 partner).</p>
      <p><strong>InaktÃ­v:</strong> Az inaktÃ­v kategÃ³riÃ¡k nem jelennek meg a frontend-en.</p>
    </div>
  </div>

  <!-- HibaÃ¼zenetek / SikeressÃ©g -->
  <% if (typeof error !== 'undefined' || (typeof query !== 'undefined' && query.error)) { %>
    <div class="alert alert-error">
      <%= typeof error !== 'undefined' ? error : (query.error || 'Hiba tÃ¶rtÃ©nt') %>
    </div>
  <% } %>

  <% if (typeof success !== 'undefined' || (typeof query !== 'undefined' && query.success)) { %>
    <div class="alert alert-success">
      <%= typeof success !== 'undefined' ? success : (query.success || 'MÅ±velet sikeres') %>
    </div>
  <% } %>
</div>
<!-- /.jobb oszlop -->
</div>
<!-- /.admin-two-col -->
</div>
<!-- /.page-container -->

<script>
function deleteCategory(id, name, partnerCount) {
  if (partnerCount > 0) {
    alert(`A "${name}" kategÃ³ria nem tÃ¶rÃ¶lhetÅ‘, mert ${partnerCount} db partner tartozik hozzÃ¡.\n\nElÅ‘szÃ¶r rendeld Ã¡t vagy tÃ¶rÃ¶ld a partnereket!`);
    return;
  }

  if (confirm(`Biztosan tÃ¶rÃ¶lni szeretnÃ©d a(z) "${name}" kategÃ³riÃ¡t?\n\nEz a mÅ±velet nem vonhatÃ³ vissza!`)) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/admin/partners/categories/${id}/delete`;
    
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = '_csrf';
    csrfInput.value = '<%= csrfToken %>';
    
    form.appendChild(csrfInput);
    document.body.appendChild(form);
    form.submit();
  }
}
</script>


