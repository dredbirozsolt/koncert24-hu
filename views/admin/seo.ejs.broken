<!-- Admin SEO specific styles -->
<style>
    .admin-container {
        background: #f5f5f5;
        min-height: 80vh;
        padding: 2rem 0;
    }

    .admin-header {
        background: white;
        padding: 1rem 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .admin-header h1 {
        color: #667eea;
        font-size: 1.5rem;
        margin: 0;
    }                                               <div>‚úÖ Dinamikus gener√°l√°s</div>
                                <div>üíæ ${sizeBytes} byte</div>
                                ${stats.userAgents ? `<div>ü§µ ${stats.userAgents} user-agent</div>` : ''}
                                ${stats.disallowRules ? `<div>üö´ ${stats.disallowRules} disallow szab√°ly</div>` : ''}
                                <div style="margin-top: 0.75rem;">
                                    <button onclick="showRobotsPreview()" class="btn btn-info">
                                        üëÅÔ∏è El≈ën√©zet
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                } else {            <div>‚úÖ Dinamikus gener√°l√°s</div>
                                <div>üíæ ${sizeBytes} byte</div>
                                ${stats.userAgents ? `<div>ü§µ ${stats.userAgents} user-agent</div>` : ''}
                                ${stats.disallowRules ? `<div>üö´ ${stats.disallowRules} disallow szab√°ly</div>` : ''}
                                <div style="margin-top: 0.75rem;">
                                    <button onclick="showRobotsPreview()" class="btn btn-info">
                                        üëÅÔ∏è El≈ën√©zet
                                    </button>                    ${stats.userAgents ? `<div>ü§µ ${stats.userAgents} user-agent</div>` : ''}
                                ${stats.disallowRules ? `<div>üö´ ${stats.disallowRules} disallow szab√°ly</div>` : ''}
                                <div style="margin-top: 0.75rem;">
                                    <button onclick="showRobotsPreview()" class="btn btn-info">
                                        üëÅÔ∏è El≈ën√©zet
                                    </button>
                                </div>                     ${stats.userAgents ? `<div>ü§µ ${stats.userAgents} user-agent</div>` : ''}
                                ${stats.disallowRules ? `<div>üö´ ${stats.disallowRules} disallow szab√°ly</div>` : ''}
                                <div style="margin-top: 0.75rem;">
                                    <button onclick="showRobotsPreview()" class="btn btn-info">
                                        üëÅÔ∏è El≈ën√©zet
                                    </button>
                                </div>admin-header .back-btn {
        background: #6c757d;
        color: white;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        font-size: 0.9rem;
    }

    .admin-header .back-btn:hover {
        background: #5a6268;
    }

    .content-wrapper {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem;
    }

    .card {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
    }

    .card h2 {
        color: #667eea;
        margin: 0 0 1rem 0;
        font-size: 1.3rem;
    }

    .card h3 {
        color: #667eea;
        margin: 0 0 1rem 0;
        font-size: 1.1rem;
    }

    .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: #667eea;
        color: white;
    }

    .btn-primary:hover {
        background: #5a67d8;
    }

    .btn-success {
        background: #28a745;
        color: white;
    }

    .btn-success:hover {
        background: #218838;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn-secondary:hover {
        background: #5a6268;
    }

    .btn-info {
        background: #17a2b8;
        color: white;
    }

    .btn-info:hover {
        background: #138496;
    }

    .loading {
        color: #667eea;
        text-align: center;
        padding: 2rem;
    }

    .error {
        color: #dc3545;
        padding: 1rem;
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 4px;
    }

    /* Toggle Switch Styles */
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
        margin-right: 0.75rem;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.3s;
        border-radius: 24px;
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
        background-color: #667eea;
    }

    .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(26px);
    }

    .toggle-switch input:focus + .toggle-slider {
        box-shadow: 0 0 1px #667eea;
    }
</style>

<div class="admin-container">
    <div class="admin-header">
        <h1>üîç SEO Be√°ll√≠t√°sok</h1>
        <a href="/admin" class="back-btn">‚Üê Vissza a Dashboard-ra</a>
    </div>

    <div class="content-wrapper">
    <!-- Sitemap Information Card -->
    <div class="card" style="margin-bottom: 2rem;">
        <h2>ÔøΩ Sitemap Be√°ll√≠t√°sok √©s Inform√°ci√≥k</h2>
        
        <!-- Sitemap Toggle Settings -->
        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="margin: 0; color: #667eea; font-size: 1.1rem;">‚öôÔ∏è Be√°ll√≠t√°sok</h3>
                <span id="sitemap-settings-status"></span>
            </div>
            
            <div id="sitemap-toggles" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div>
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <label class="toggle-switch">
                            <input type="checkbox" name="sitemapEnabled" value="true" <%= settings.sitemapEnabled ? 'checked' : '' %> onchange="saveSitemapToggle(this)">
                            <span class="toggle-slider"></span>
                        </label>
                        <span>Sitemap gener√°l√°s enged√©lyez√©se</span>
                    </label>
                </div>
                
                <div>
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <label class="toggle-switch">
                            <input type="checkbox" name="autoGenerate" value="true" <%= settings.autoGenerate ? 'checked' : '' %> onchange="saveSitemapToggle(this)">
                            <span class="toggle-slider"></span>
                        </label>
                        <span>Automatikus gener√°l√°s (napi 2:00)</span>
                    </label>
                </div>
                
                <div>
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <label class="toggle-switch">
                            <input type="checkbox" name="pingEnabled" value="true" <%= settings.pingEnabled ? 'checked' : '' %> onchange="saveSitemapToggle(this)">
                            <span class="toggle-slider"></span>
                        </label>
                        <span>Keres≈ëmotorok automatikus √©rtes√≠t√©se</span>
                    </label>
                </div>
                
                <div>
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <label class="toggle-switch">
                            <input type="checkbox" name="robotsTxtEnabled" value="true" <%= settings.robotsTxtEnabled ? 'checked' : '' %> onchange="saveSitemapToggle(this)">
                            <span class="toggle-slider"></span>
                        </label>
                        <span>Robots.txt enged√©lyez√©se</span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Sitemap Info -->
        <div style="margin-bottom: 1.5rem;">
            <h3 style="margin: 0 0 1rem 0; color: #667eea; font-size: 1.1rem;">üìä St√°tusz</h3>
            <div id="sitemap-info" style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                <div class="loading">üîÑ Inform√°ci√≥k bet√∂lt√©se...</div>
            </div>
        </div>
        
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <button onclick="generateSitemap()" class="btn btn-primary">
                üîÑ Sitemap Gener√°l√°s Most
            </button>
            <button onclick="pingSearchEngines()" class="btn btn-success">
                üì° Keres≈ëmotorok √ârtes√≠t√©se
            </button>
            <a href="/sitemap.xml" target="_blank" class="btn btn-secondary">
                üëÅÔ∏è Sitemap Megtekint√©se
            </a>
            <a href="/robots.txt" target="_blank" class="btn btn-secondary">
                ü§ñ Robots.txt Megtekint√©se
            </a>
        </div>
        <span id="sitemap-status" style="display: inline-block; margin-top: 1rem;"></span>
    </div>

    <!-- Google Services Settings Card -->
    <div class="card" style="margin-bottom: 2rem;">
        <h2>üîó Google Szolg√°ltat√°sok</h2>
        
        <form id="google-services-form">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        Google Analytics ID
                    </label>
                    <input 
                        type="text" 
                        name="googleAnalyticsId" 
                        value="<%= settings.googleAnalyticsId %>"
                        placeholder="G-XXXXXXXXXX vagy UA-XXXXXXXXX-X"
                        style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;"
                    >
                    <small style="color: #666; display: block; margin-top: 0.25rem;">
                        Pl: G-ABC123DEF4
                    </small>
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        Google Tag Manager ID
                    </label>
                    <input 
                        type="text" 
                        name="googleTagManagerId" 
                        value="<%= settings.googleTagManagerId %>"
                        placeholder="GTM-XXXXXXX"
                        style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;"
                    >
                    <small style="color: #666; display: block; margin-top: 0.25rem;">
                        Pl: GTM-ABC1234
                    </small>
                </div>

                <div>
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        Google Search Console Verification
                    </label>
                    <input 
                        type="text" 
                        name="googleSearchConsole" 
                        value="<%= settings.googleSearchConsole %>"
                        placeholder="google-site-verification k√≥d"
                        style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;"
                    >
                    <small style="color: #666; display: block; margin-top: 0.25rem;">
                        Meta tag tartalom √©rt√©ke
                    </small>
                </div>
            </div>

            <!-- GTM √ötmutat√≥ -->
            <div style="margin-bottom: 1.5rem;">
                <button type="button" class="btn btn-info" onclick="toggleGtmGuide()">
                    üìã GTM Be√°ll√≠t√°si √ötmutat√≥
                </button>
            </div>
            
            <div id="gtm-guide" style="display: none; background: #f8f9fa; border: 2px solid #667eea; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h4 style="margin: 0 0 1rem 0; color: #667eea;">üìã GTM Be√°ll√≠t√°si √ötmutat√≥</h4>
                <div style="line-height: 1.8; color: #333;">
                    <div style="margin-bottom: 1rem;">
                        <strong>üîπ 1. Google Tag Manager fi√≥k l√©trehoz√°sa</strong><br>
                        Menj ide: <a href="https://tagmanager.google.com" target="_blank" style="color: #667eea;">https://tagmanager.google.com</a><br>
                        Hozz l√©tre egy √∫j fi√≥kot (Account):<br>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                            <li>N√©v: pl. a c√©ged neve</li>
                            <li>Orsz√°g: Magyarorsz√°g</li>
                            <li>Container neve: pl. ‚ÄûWeboldal"</li>
                            <li>Platform: Web</li>
                            <li>Kapsz egy GTM k√≥dot</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <strong>üîπ 2. GTM k√≥d beilleszt√©se</strong><br>
                        Ezen az oldalon a <strong>Google Tag Manager ID</strong> mez≈ëbe illeszd be a GTM √°ltal adott azonos√≠t√≥t (pl. GTM-XXXXXXX).<br>
                        Innent≈ël minden k√∂vet√©s innen megy, nem kell k√ºl√∂n GA vagy Pixel k√≥dot beilleszteni.
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <strong>üîπ 3. Google Analytics 4 (GA4) bek√∂t√©se GTM-be</strong><br>
                        GTM admin fel√ºlet ‚Üí Tags ‚Üí New ‚Üí Google Analytics: GA4 Configuration.<br>
                        Add meg a Measurement ID-t (ilyesmi: G-XXXXXXX), amit a Google Analytics-ben tal√°lsz.<br>
                        Trigger: All Pages (√≠gy minden oldalon fut).<br>
                        Ment√©s ‚Üí Publish.
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <strong>üîπ 4. Facebook Pixel bek√∂t√©se GTM-be</strong><br>
                        GTM ‚Üí Tags ‚Üí New ‚Üí Custom HTML.<br>
                        Illeszd be a Facebook Pixel k√≥dot (Events Managerb≈ël kapod).<br>
                        Trigger: All Pages (ha minden oldalon fusson), vagy csak bizonyos oldalakon (pl. k√∂sz√∂n≈ëoldal).<br>
                        Ha konverzi√≥kat is akarsz m√©rni (pl. gombkattint√°s, v√°s√°rl√°s), akkor k√ºl√∂n ‚ÄûEvent Tag"-et hozol l√©tre.
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <strong>üîπ 5. Tesztel√©s</strong><br>
                        GTM-ben van Preview Mode ‚Üí l√°tod, mely tagek futnak.<br>
                        Google Tag Assistant Chrome b≈ëv√≠tm√©nnyel ellen≈ërizheted.<br>
                        GA4-ben √©s a Facebook Events Managerben is l√°tsz majd √©l≈ë adatokat.
                    </div>
                    
                    <div>
                        <strong>üîπ 6. Publik√°l√°s √©s karbantart√°s</strong><br>
                        Ha minden m≈±k√∂dik ‚Üí Publish.<br>
                        Ha √∫j k√∂vet√©st akarsz hozz√°adni (pl. LinkedIn, TikTok, Hotjar), csak GTM-ben kell l√©trehozni, nem kell a weboldalhoz ny√∫lni.
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; align-items: center;">
                <button type="submit" class="btn btn-primary">
                    üíæ Google Szolg√°ltat√°sok Ment√©se
                </button>
                <span id="google-services-status"></span>
            </div>
        </form>
    </div>

    <!-- SEO Info Box -->
    <div class="card" style="background: #e7f3ff; border-left: 4px solid #667eea;">
        <h3 style="margin: 0 0 1rem 0; color: #333;">‚ÑπÔ∏è SEO Tippek</h3>
        <ul style="margin: 0; padding-left: 1.5rem; color: #555; line-height: 1.8;">
            <li>A sitemap automatikusan naponta 2:00-kor gener√°l√≥dik √©s √©rtes√≠ti a keres≈ëmotorokat</li>
            <li>Manu√°lisan is gener√°lhatsz sitemap-et, ha √∫j tartalom ker√ºlt az oldalra</li>
            <li><strong>A robots.txt dinamikusan gener√°l√≥dik</strong> a be√°ll√≠t√°sok alapj√°n</li>
            <li>Google Analytics √©s Tag Manager seg√≠t k√∂vetni a l√°togat√≥kat</li>
            <li>Search Console verification sz√ºks√©ges a Google webmastertools haszn√°lat√°hoz</li>
        </ul>
    </div>

    <!-- Robots.txt Preview Modal -->
    <div id="robots-preview-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; overflow: auto;">
        <div style="background: white; margin: 2rem auto; max-width: 800px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <div style="padding: 1.5rem; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; color: #667eea;">ü§ñ Robots.txt El≈ën√©zet</h3>
                <button onclick="closeRobotsPreview()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999;">√ó</button>
            </div>
            <div style="padding: 1.5rem;">
                <div id="robots-stats" style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px; display: none;">
                    <!-- Stats will be inserted here -->
                </div>
                <pre id="robots-content" style="background: #2d2d2d; color: #f8f8f2; padding: 1.5rem; border-radius: 4px; overflow-x: auto; font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.5; max-height: 60vh; overflow-y: auto;">Bet√∂lt√©s...</pre>
            </div>
            <div style="padding: 1.5rem; border-top: 1px solid #e0e0e0; text-align: right;">
                <a href="/robots.txt" target="_blank" class="btn btn-primary" style="margin-right: 0.5rem;">
                    üåê √âl≈ë Robots.txt Megtekint√©se
                </a>
                <button onclick="closeRobotsPreview()" class="btn btn-secondary">
                    Bez√°r√°s
                </button>
            </div>
        </div>
    </div>

    <!-- Sitemap.xml Preview Modal -->
    <div id="sitemap-preview-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; overflow: auto;">
        <div style="background: white; margin: 2rem auto; max-width: 1000px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <div style="padding: 1.5rem; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; color: #667eea;">üìÑ Sitemap.xml El≈ën√©zet</h3>
                <button onclick="closeSitemapPreview()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999;">√ó</button>
            </div>
            <div style="padding: 1.5rem;">
                <div id="sitemap-stats" style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px; display: none;">
                    <!-- Stats will be inserted here -->
                </div>
                <pre id="sitemap-content" style="background: #2d2d2d; color: #f8f8f2; padding: 1.5rem; border-radius: 4px; overflow-x: auto; font-family: 'Courier New', monospace; font-size: 0.85rem; line-height: 1.5; max-height: 60vh; overflow-y: auto;">Bet√∂lt√©s...</pre>
            </div>
            <div style="padding: 1.5rem; border-top: 1px solid #e0e0e0; text-align: right;">
                <a href="/sitemap.xml" target="_blank" class="btn btn-primary" style="margin-right: 0.5rem;">
                    üåê √âl≈ë Sitemap.xml Megtekint√©se
                </a>
                <button onclick="closeSitemapPreview()" class="btn btn-secondary">
                    Bez√°r√°s
                </button>
            </div>
        </div>
    </div>

    </div> <!-- /content-wrapper -->
</div> <!-- /admin-container -->

<script>
    // Load sitemap information on page load
    async function loadSitemapInfo() {
        try {
            const response = await fetch('/admin/seo/sitemap-info');
            const data = await response.json();
            
            if (data.success) {
                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">';
                
                // Sitemap info
                if (data.sitemap.exists) {
                    const modified = new Date(data.sitemap.modified).toLocaleString('hu-HU');
                    const sizeKB = (data.sitemap.size / 1024).toFixed(2);
                    
                    html += `
                        <div style="padding: 1rem; background: white; border-radius: 4px; border: 1px solid #e0e0e0;">
                            <div style="font-weight: bold; color: #667eea; margin-bottom: 0.5rem;">üìÑ Sitemap.xml</div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <div>‚úÖ L√©tezik</div>
                                <div>üìä ${data.sitemap.urlCount} URL</div>
                                <div>üíæ ${sizeKB} KB</div>
                                <div>üïí ${modified}</div>
                                <div style="margin-top: 0.75rem;">
                                    <button onclick="showSitemapPreview()" class="btn btn-info">
                                        üëÅÔ∏è El≈ën√©zet
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div style="padding: 1rem; background: white; border-radius: 4px; border: 1px solid #e0e0e0;">
                            <div style="font-weight: bold; color: #667eea; margin-bottom: 0.5rem;">üìÑ Sitemap.xml</div>
                            <div style="font-size: 0.9rem; color: #999;">
                                ‚ùå M√©g nincs gener√°lva
                            </div>
                        </div>
                    `;
                }
                
                // Robots.txt info (dinamikus)
                if (data.robots.exists) {
                    const sizeBytes = data.robots.size || 0;
                    const stats = data.robots.stats || {};
                    
                    html += `
                        <div style="padding: 1rem; background: white; border-radius: 4px; border: 1px solid #e0e0e0;">
                            <div style="font-weight: bold; color: #667eea; margin-bottom: 0.5rem;">ü§ñ Robots.txt</div>
                            <div style="font-size: 0.9rem; color: #666;">
                                <div>‚úÖ Dinamikus gener√°l√°s</div>
                                <div>üíæ ${sizeBytes} byte</div>
                                ${stats.userAgents ? `<div>ÔøΩ ${stats.userAgents} user-agent</div>` : ''}
                                ${stats.disallowRules ? `<div>üö´ ${stats.disallowRules} disallow szab√°ly</div>` : ''}
                                <div style="margin-top: 0.5rem;">
                                    <button onclick="showRobotsPreview()" class="btn btn-info" >
                                        üëÅÔ∏è El≈ën√©zet
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div style="padding: 1rem; background: white; border-radius: 4px; border: 1px solid #e0e0e0;">
                            <div style="font-weight: bold; color: #667eea; margin-bottom: 0.5rem;">ü§ñ Robots.txt</div>
                            <div style="font-size: 0.9rem; color: #999;">
                                ‚ö†Ô∏è Dinamikus gener√°l√°s akt√≠v
                            </div>
                        </div>
                    `;
                }
                
                html += '</div>';
                
                document.getElementById('sitemap-info').innerHTML = html;
            } else {
                document.getElementById('sitemap-info').innerHTML = '<div class="error">‚ùå Hiba az inform√°ci√≥k bet√∂lt√©sekor</div>';
            }
        } catch (error) {
            console.error('Error loading sitemap info:', error);
            document.getElementById('sitemap-info').innerHTML = '<div class="error">‚ùå Hiba: ' + error.message + '</div>';
        }
    }

    // Generate sitemap
    async function generateSitemap() {
        const statusEl = document.getElementById('sitemap-status');
        statusEl.innerHTML = '<span style="color: #667eea;">üîÑ Gener√°l√°s folyamatban...</span>';
        
        try {
            const response = await fetch('/admin/seo/generate-sitemap', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            
            const data = await response.json();
            
            if (data.success) {
                statusEl.innerHTML = '<span style="color: #28a745;">‚úÖ ' + data.message + '</span>';
                setTimeout(() => loadSitemapInfo(), 500);
            } else {
                statusEl.innerHTML = '<span style="color: #dc3545;">‚ùå ' + data.message + '</span>';
            }
        } catch (error) {
            statusEl.innerHTML = '<span style="color: #dc3545;">‚ùå Hiba: ' + error.message + '</span>';
        }
        
        setTimeout(() => { statusEl.innerHTML = ''; }, 5000);
    }

    // Ping search engines
    async function pingSearchEngines() {
        const statusEl = document.getElementById('sitemap-status');
        statusEl.innerHTML = '<span style="color: #667eea;">üì° √ârtes√≠t√©s folyamatban...</span>';
        
        try {
            const response = await fetch('/admin/seo/ping-search-engines', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            
            const data = await response.json();
            
            if (data.success) {
                statusEl.innerHTML = '<span style="color: #28a745;">‚úÖ ' + data.message + '</span>';
            } else {
                statusEl.innerHTML = '<span style="color: #dc3545;">‚ùå ' + data.message + '</span>';
            }
        } catch (error) {
            statusEl.innerHTML = '<span style="color: #dc3545;">‚ùå Hiba: ' + error.message + '</span>';
        }
        
        setTimeout(() => { statusEl.innerHTML = ''; }, 5000);
    }

    // Save SEO settings
    async function saveSitemapToggle(checkbox) {
        const statusEl = document.getElementById('sitemap-settings-status');
        statusEl.innerHTML = '<span style="color: #667eea; font-size: 0.9rem;">üíæ Ment√©s...</span>';
        
        // Get all toggle states
        const toggles = document.querySelectorAll('#sitemap-toggles input[type="checkbox"]');
        const data = {};
        
        toggles.forEach(toggle => {
            data[toggle.name] = toggle.checked ? 'true' : 'false';
        });
        
        try {
            const response = await fetch('/admin/seo/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            if (result.success) {
                statusEl.innerHTML = '<span style="color: #28a745; font-size: 0.9rem;">‚úÖ Mentve</span>';
            } else {
                statusEl.innerHTML = '<span style="color: #dc3545; font-size: 0.9rem;">‚ùå ' + result.message + '</span>';
            }
        } catch (error) {
            statusEl.innerHTML = '<span style="color: #dc3545; font-size: 0.9rem;">‚ùå Hiba: ' + error.message + '</span>';
        }
        
        setTimeout(() => { statusEl.innerHTML = ''; }, 2000);
    }

    // Save Google Services settings
    document.getElementById('google-services-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const statusEl = document.getElementById('google-services-status');
        statusEl.innerHTML = '<span style="color: #667eea;">üíæ Ment√©s...</span>';
        
        const formData = new FormData(this);
        const data = Object.fromEntries(formData);
        
        try {
            const response = await fetch('/admin/seo/settings', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            if (result.success) {
                statusEl.innerHTML = '<span style="color: #28a745;">‚úÖ ' + result.message + '</span>';
            } else {
                statusEl.innerHTML = '<span style="color: #dc3545;">‚ùå ' + result.message + '</span>';
            }
        } catch (error) {
            statusEl.innerHTML = '<span style="color: #dc3545;">‚ùå Hiba: ' + error.message + '</span>';
        }
        
        setTimeout(() => { statusEl.innerHTML = ''; }, 3000);
    });

    // Toggle GTM Guide
    function toggleGtmGuide() {
        const guide = document.getElementById('gtm-guide');
        if (guide.style.display === 'none') {
            guide.style.display = 'block';
            guide.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } else {
            guide.style.display = 'none';
        }
    }

    // Show Robots.txt Preview
    async function showRobotsPreview() {
        const modal = document.getElementById('robots-preview-modal');
        const contentEl = document.getElementById('robots-content');
        const statsEl = document.getElementById('robots-stats');
        
        modal.style.display = 'block';
        contentEl.textContent = 'üîÑ Bet√∂lt√©s...';
        statsEl.style.display = 'none';
        
        try {
            const response = await fetch('/admin/seo/robots-preview');
            const data = await response.json();
            
            if (data.success) {
                contentEl.textContent = data.content;
                
                // Display stats if available
                if (data.stats) {
                    const stats = data.stats;
                    statsEl.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; font-size: 0.9rem;">
                            <div><strong>Sorok:</strong> ${stats.totalLines}</div>
                            <div><strong>User-agents:</strong> ${stats.userAgents}</div>
                            <div><strong>Disallow:</strong> ${stats.disallowRules}</div>
                            <div><strong>Allow:</strong> ${stats.allowRules}</div>
                            <div><strong>Sitemaps:</strong> ${stats.sitemaps}</div>
                            <div><strong>M√©ret:</strong> ${stats.size} byte</div>
                        </div>
                    `;
                    statsEl.style.display = 'block';
                }
            } else {
                contentEl.textContent = '‚ùå Hiba a bet√∂lt√©s sor√°n: ' + data.message;
            }
        } catch (error) {
            contentEl.textContent = '‚ùå Hiba: ' + error.message;
        }
    }

    // Close Robots.txt Preview
    function closeRobotsPreview() {
        document.getElementById('robots-preview-modal').style.display = 'none';
    }

    // Show Sitemap.xml Preview
    async function showSitemapPreview() {
        const modal = document.getElementById('sitemap-preview-modal');
        const contentEl = document.getElementById('sitemap-content');
        const statsEl = document.getElementById('sitemap-stats');
        
        modal.style.display = 'block';
        contentEl.textContent = 'üîÑ Bet√∂lt√©s...';
        statsEl.style.display = 'none';
        
        try {
            const response = await fetch('/sitemap.xml');
            const text = await response.text();
            
            if (response.ok) {
                contentEl.textContent = text;
                
                // Parse and display stats
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(text, 'text/xml');
                const urls = xmlDoc.getElementsByTagName('url');
                const lastmod = xmlDoc.getElementsByTagName('lastmod');
                const changefreq = xmlDoc.getElementsByTagName('changefreq');
                const priority = xmlDoc.getElementsByTagName('priority');
                
                statsEl.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; font-size: 0.9rem;">
                        <div><strong>URL-ek:</strong> ${urls.length}</div>
                        <div><strong>Lastmod:</strong> ${lastmod.length}</div>
                        <div><strong>Changefreq:</strong> ${changefreq.length}</div>
                        <div><strong>Priority:</strong> ${priority.length}</div>
                        <div><strong>M√©ret:</strong> ${(text.length / 1024).toFixed(2)} KB</div>
                        <div><strong>Karakterek:</strong> ${text.length}</div>
                    </div>
                `;
                statsEl.style.display = 'block';
            } else {
                contentEl.textContent = '‚ùå Hiba a bet√∂lt√©s sor√°n: ' + response.status;
            }
        } catch (error) {
            contentEl.textContent = '‚ùå Hiba: ' + error.message;
        }
    }

    // Close Sitemap.xml Preview
    function closeSitemapPreview() {
        document.getElementById('sitemap-preview-modal').style.display = 'none';
    }

    // Close modal on background click
    document.addEventListener('click', (e) => {
        const robotsModal = document.getElementById('robots-preview-modal');
        const sitemapModal = document.getElementById('sitemap-preview-modal');
        
        if (e.target === robotsModal) {
            closeRobotsPreview();
        }
        if (e.target === sitemapModal) {
            closeSitemapPreview();
        }
    });

    // Load info on page load
    window.addEventListener('DOMContentLoaded', () => {
        loadSitemapInfo();
    });
</script>