<!-- Concert Booking System -->
<div class="booking-system"
    x-data="bookingSystem(<% if (typeof performer !== 'undefined' && performer) { %>{ performer: '<%= performer.name %>', performerId: <%= performer.id %> }<% } %>)"
    @date-confirmed="handleDateConfirmed($event)" @time-confirmed="handleTimeConfirmed($event)"
    @location-selected="handleLocationSelected($event)">
    <div class="booking-header">
        <h1 class="booking-title">
            V√°laszd ki a
            <span class="text-primary">rendezv√©ny r√©szleteit!</span>
        </h1>
    </div>

    <form class="booking-form" @submit.prevent="submitBooking">
        <!-- Date Selection -->
        <div class="form__group">
            <label class="form__label">
                <span class="label-icon">üìÖ</span>
                Melyik napon rendezn√©d az esem√©nyt?
            </label>
            <div class="date-picker" x-data="datePicker()" x-init="init()">
                <!-- Selected Date Display -->
                <div class="selected-date-display" @click="showCalendar = !showCalendar" tabindex="0">
                    <div class="date-display">
                        <span x-show="!selectedDate" class="placeholder">V√°lassz d√°tumot</span>
                        <span x-show="selectedDate" class="selected-date-text" x-text="formatSelectedDate()"></span>
                    </div>
                    <svg class="dropdown-icon" :class="{ 'rotate-180': showCalendar }" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd" />
                    </svg>
                </div>

                <!-- Calendar Popup -->
                <div x-show="showCalendar" x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
                    @click.outside="showCalendar = false" class="calendar-popup">

                    <!-- Calendar Header -->
                    <div class="calendar-header">
                        <button type="button" @click="previousMonth()" class="nav-button">
                            <svg viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>

                        <h3 class="month-year" x-text="formatMonthYear()"></h3>

                        <button type="button" @click="nextMonth()" class="nav-button">
                            <svg viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                    clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>

                    <!-- Days of Week -->
                    <div class="weekdays">
                        <div class="weekday">H</div>
                        <div class="weekday">K</div>
                        <div class="weekday">Sze</div>
                        <div class="weekday">Cs</div>
                        <div class="weekday">P</div>
                        <div class="weekday">Szo</div>
                        <div class="weekday">V</div>
                    </div>

                    <!-- Calendar Grid -->
                    <div class="calendar-grid">
                        <template x-for="date in calendarDates" :key="date.key">
                            <button type="button" @click="selectDate(date)" :disabled="date.disabled" :class="{
                                            'calendar-day': true,
                                            'other-month': date.otherMonth,
                                            'selected': date.selected,
                                            'today': date.today,
                                            'disabled': date.disabled
                                        }" x-text="date.day">
                            </button>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <!-- Time Selection -->
        <div class="form__group">
            <label class="form__label">
                <span class="label-icon">üïê</span>
                H√°ny √≥rakor kezd≈ëdj√∂n az esem√©ny?
            </label>
            <div class="time-picker" x-data="timePicker()" x-init="init()">
                <!-- Selected Time Display -->
                <div class="selected-time-display" @click="showTimePicker = !showTimePicker" tabindex="0">
                    <div class="time-display">
                        <span x-show="!selectedHour && !selectedMinute" class="placeholder">V√°lassz
                            id≈ëpontot</span>
                        <span x-show="selectedHour !== null && selectedMinute !== null" class="selected-time-text"
                            x-text="selectedHour + ':' + selectedMinute"></span>
                    </div>
                    <svg class="dropdown-icon" :class="{ 'rotate-180': showTimePicker }" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                            clip-rule="evenodd" />
                    </svg>
                </div>

                <!-- Time Picker Popup -->
                <div x-show="showTimePicker" x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
                    @click.outside="handleTimePickerClose()" class="time-picker-popup">

                    <h4 class="time-title">Id≈ëpont kiv√°laszt√°sa</h4>
                    <div class="time-picker-container">
                        <!-- Hour Wheel -->
                        <div class="wheel-picker hour-wheel">
                            <div class="wheel-label">√ìra</div>
                            <div class="wheel-container" @wheel.prevent="handleHourWheel($event)"
                                @touchstart="handleHourTouchStart($event)"
                                @touchmove.prevent="handleHourTouchMove($event)" @touchend="handleHourTouchEnd($event)">
                                <div class="wheel-mask">
                                    <div class="wheel-selection-overlay"></div>
                                    <div class="wheel-items" :style="`transform: translateY(${hourOffset}px)`">
                                        <template x-for="(hour, index) in availableHours" :key="index">
                                            <div class="wheel-item" :class="{ 'selected': index === selectedHourIndex }"
                                                @click="selectHour(index)" x-text="hour">
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="time-separator-wheel">:</div>

                        <!-- Minute Wheel -->
                        <div class="wheel-picker minute-wheel">
                            <div class="wheel-label">Perc</div>
                            <div class="wheel-container" @wheel.prevent="handleMinuteWheel($event)"
                                @touchstart="handleMinuteTouchStart($event)"
                                @touchmove.prevent="handleMinuteTouchMove($event)"
                                @touchend="handleMinuteTouchEnd($event)">
                                <div class="wheel-mask">
                                    <div class="wheel-selection-overlay"></div>
                                    <div class="wheel-items" :style="`transform: translateY(${minuteOffset}px)`">
                                        <template x-for="(minute, index) in availableMinutes" :key="index">
                                            <div class="wheel-item"
                                                :class="{ 'selected': index === selectedMinuteIndex }"
                                                @click="selectMinute(index)" x-text="minute">
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="time-picker-actions">
                        <button type="button" @click="confirmTime()" class="confirm-btn">
                            Id≈ëpont meger≈ës√≠t√©se
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location -->
        <!-- Location -->
        <div class="form__group">
            <label class="form__label">
                <span class="label-icon">üìç</span>
                Hol rendezn√©d az esem√©nyt?
            </label>
            <div class="location-search" x-data="locationSearch()">
                <input type="text" class="form__input" placeholder="√çrd be a helys√©gnevet" x-model="query"
                    @input="handleInput()" @focus="showSuggestions = true" @blur="hideSuggestions()"
                    @keydown.arrow-down.prevent="highlightNext()" @keydown.arrow-up.prevent="highlightPrevious()"
                    @keydown.enter.prevent="selectHighlighted()" @keydown.escape="hideSuggestions()" autocomplete="off">

                <div class="location-suggestions" x-show="showSuggestions && suggestions.length > 0" x-transition>
                    <template x-for="(suggestion, index) in suggestions" :key="index">
                        <div class="suggestion-item" :class="{ 'highlighted': index === highlightedIndex }"
                            @mousedown.prevent="selectLocation(suggestion)" @mouseenter="highlightedIndex = index">
                            <div class="suggestion-name" x-text="suggestion.name"></div>
                            <div class="suggestion-country" x-text="suggestion.country"></div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Event Type -->
        <div class="form__group">
            <label class="form__label">
                <span class="label-icon">üé™</span>
                Milyen m≈±sor t√≠pus√∫ esem√©nyt szeretn√©l rendezni?
            </label>
            <select x-model="booking.eventType" class="form__select" required>
                <option value="">V√°lassz m≈±sor t√≠pust</option>
                <option value="outdoor_free">Nyilv√°nos ingyenes rendezv√©ny szabadt√©ren</option>
                <option value="outdoor_paid">Nyilv√°nos bel√©p≈ëjegyes rendezv√©ny szabadt√©ren</option>
                <option value="indoor_free">Nyilv√°nos ingyenes rendezv√©ny z√°rt helyis√©gben</option>
                <option value="indoor_paid">Nyilv√°nos bel√©p≈ëjegyes rendezv√©ny z√°rt helyis√©gben</option>
                <option value="private_personal">Z√°rtk√∂r≈± mag√°nrendezv√©ny</option>
                <option value="private_corporate">Z√°rtk√∂r≈± c√©ges rendezv√©ny</option>
            </select>
        </div>

        <!-- Performer Search -->
        <div class="form__group">
            <label class="form__label">
                <span class="label-icon">üé§</span>
                <% if (typeof performer !=='undefined' && performer) { %>
                    Kiv√°lasztott el≈ëad√≥
                    <% } else { %>
                        Melyik el≈ëlad√≥t keresed?
                        <% } %>
            </label>
            <% if (typeof performer !=='undefined' && performer) { %>
                <!-- Pre-selected performer on performer detail page -->
                <div class="selected-performer-display">
                    <div class="performer-info">
                        <span class="performer__name">
                            <%= performer.name %>
                        </span>
                        <span class="performer-category">
                            <%= performer.getCategoryDisplayName() %>
                        </span>
                    </div>
                    <input type="hidden" x-model="booking.performer" value="<%= performer.name %>">
                    <input type="hidden" x-model="booking.performerId" value="<%= performer.id %>">
                </div>
                <% } else { %>
                    <!-- Performer search on homepage -->
                    <div class="performer-search" x-data="{ suggestions: [], showSuggestions: false }">
                        <input type="text" x-model="booking.performer" @input="searchPerformers($event.target.value)"
                            @focus="showSuggestions = true" @blur="setTimeout(() => showSuggestions = false, 200)"
                            class="form__input" placeholder="Kezdd el g√©pelni az el≈ëad√≥ nev√©t...">

                        <div x-show="showSuggestions && suggestions.length > 0" class="suggestions-dropdown"
                            x-transition>
                            <template x-for="suggestion in suggestions" :key="suggestion.id">
                                <div class="suggestion-item" @click="selectPerformer(suggestion)">
                                    <div class="suggestion-info">
                                        <span class="suggestion-name" x-text="suggestion.name"></span>
                                        <span class="suggestion-category" x-text="suggestion.category"></span>
                                    </div>
                                    <span class="suggestion-price"
                                        x-text="suggestion.price ? new Intl.NumberFormat('hu-HU').format(suggestion.price) + ' Ft-t√≥l' : ''"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                    <% } %>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
            <button type="button" class="btn btn--primary btn-large" x-bind:disabled="isSubmitting"
                @click="submitBooking()">
                <span x-show="!isSubmitting">Aj√°nlatot k√©rek!</span>
                <span x-show="isSubmitting">K√ºld√©s...</span>
            </button>
        </div>
    </form>
</div>
</div>